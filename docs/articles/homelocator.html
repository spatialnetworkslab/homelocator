<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>homelocator • homelocator</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="homelocator">
<meta property="og:description" content="homelocator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">homelocator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/homelocator.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/quick-start.html">Quick start</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>homelocator</h1>
            
      
      
      <div class="hidden name"><code>homelocator.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p align="justify">
Identifying meaningful locations, such as home and/or work locations
from mobile technology is an essential step in the field of mobility
analysis. The <code>homelocator</code> library is designed for
identifying home locations of user based on the spatio-temporally
features contained within the mobility data, such as social media data,
mobile phone data, mobile app data and so on.
</p>
<p align="justify">
Although there is a myriad of different approaches to inferring
meaningful locations in the last 10 years, a consensus or single best
approach has not emerged in the current state-of-the-art. The actual
algorithms used are not always discussed in detail in publications and
the source codes are seldom released in public, which makes comparing
algorithms as well as reproducing work difficult.
</p>
<p align="justify">
So, the main objective for developing this package is to provide a
consistent framework and interface for the adoption of different
approaches so that researchers are able to write structured, algorithmic
‘recipes’, or use the existing embedded “recipes” to identify meaningful
locations according to their research requirements. With this package,
users are able to achieve an apples-to-apples comparison across
approaches.
</p>
<p align="justify">
We hope that through packages like <code>homelocator</code>, future work
that relies on the inference of meaningful locations becomes less
‘custom’ (with each researcher writing their own algorithm) but instead
will use common, comparable algorithms in order to increase transparency
and reproducibility in the field.
</p>
</div>
<div class="section level2">
<h2 id="load-library">Load Library<a class="anchor" aria-label="anchor" href="#load-library"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load homelocator library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">homelocator</span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to homelocator package!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="test-data">Test Data<a class="anchor" aria-label="anchor" href="#test-data"></a>
</h2>
<p>To explore the basic data manipulation functions of
<code>homelocator</code>, we’ll use a <code>test_sample</code>
dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"test_sample"</span>, package <span class="op">=</span> <span class="st">"homelocator"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show test sample </span></span>
<span><span class="va">test_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;       u_id created_at          grid_id</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 2016-04-17 <span style="color: #949494;">22:43:06</span>    <span style="text-decoration: underline;">1</span>581</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 33<span style="text-decoration: underline;">908</span>340 2014-10-03 <span style="color: #949494;">16:29:48</span>    <span style="text-decoration: underline;">1</span>461</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 92<span style="text-decoration: underline;">298</span>565 2014-02-07 <span style="color: #949494;">07:26:15</span>    <span style="text-decoration: underline;">1</span>136</span></span></code></pre></div>
<p><span style="color:red"><em>Note:</em></span> <em>if you use your own
dataset, please make sure that you have converted the timestamps to the
appropriate local time zone.</em></p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<div class="section level4">
<h4 id="validate-input-dataset">Validate input dataset<a class="anchor" aria-label="anchor" href="#validate-input-dataset"></a>
</h4>
<p>The <code><a href="../reference/validate_dataset.html">validate_dataset()</a></code> function makes sure your input
dataset contains all three necessary variables: user, location and
timestamp. There are 4 arguments in this function:</p>
<ul>
<li>
<code>user</code>: name of column that holds a unique identifier for
each user.</li>
<li>
<code>timestamp</code>: name of column that holds specific timestamp
for each data point. This timestamp should be in <code>POSIXct</code>
format.</li>
<li>
<code>location</code>: name of column that holds a unique identifier
for each location.</li>
<li>
<code>keep_other_vars</code>: option to keep or remove any other
variables of the input dataset. The default is <code>FALSE</code>.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_validated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_dataset.html">validate_dataset</a></span><span class="op">(</span><span class="va">test_sample</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, timestamp <span class="op">=</span> <span class="st">"created_at"</span>, location <span class="op">=</span> <span class="st">"grid_id"</span>, keep_other_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🎉 Congratulations!! Your dataset has passed validation.</span></span>
<span><span class="co">#&gt; 👤 There are 100 unique users in your dataset.</span></span>
<span><span class="co">#&gt; 🌏 Now start your journey identifying their meaningful location(s)!</span></span>
<span><span class="co">#&gt; 👏 Good luck!</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_validated</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;       u_id grid_id created_at         </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565    <span style="text-decoration: underline;">1</span>581 2016-04-17 <span style="color: #949494;">22:43:06</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 33<span style="text-decoration: underline;">908</span>340    <span style="text-decoration: underline;">1</span>461 2014-10-03 <span style="color: #949494;">16:29:48</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 92<span style="text-decoration: underline;">298</span>565    <span style="text-decoration: underline;">1</span>136 2014-02-07 <span style="color: #949494;">07:26:15</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="nest-and-unnest">Nest and Unnest<a class="anchor" aria-label="anchor" href="#nest-and-unnest"></a>
</h4>
<p>The <code><a href="../reference/nest_verbose.html">nest_verbose()</a></code> and <code><a href="../reference/unnest_verbose.html">unnest_verbose()</a></code>
functions work in the same way as <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/nest" class="external-link">nest</a>
and <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/unnest" class="external-link">unnest</a>
functions in <a href="https://github.com/tidyverse/tidyverse" class="external-link">tidyverse</a> but with
some additional status information such as the elapsed running time.</p>
<ul>
<li>
<code>df</code>: a dataframe</li>
<li>
<code>...</code>: for <code><a href="../reference/nest_verbose.html">nest_verbose()</a></code> refers to selected
columns to nest and for <code><a href="../reference/unnest_verbose.html">unnest_verbose()</a></code> refers to the list
column to unnest.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># nest data</span></span>
<span><span class="va">df_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nest_verbose.html">nest_verbose</a></span><span class="op">(</span><span class="va">df_validated</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"created_at"</span>, <span class="st">"grid_id"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start nesting...</span></span>
<span><span class="co">#&gt; ✅ Finish nesting!</span></span>
<span><span class="co">#&gt; ⌛ Nesting time: 0.019 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_nested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data                </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [1,291 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 33<span style="text-decoration: underline;">908</span>340 <span style="color: #949494;">&lt;tibble [1,170 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 11<span style="text-decoration: underline;">616</span>678 <span style="color: #949494;">&lt;tibble [938 × 2]&gt;</span></span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_nested</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   created_at          grid_id</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2016-04-17 <span style="color: #949494;">22:43:06</span>    <span style="text-decoration: underline;">1</span>581</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2014-02-07 <span style="color: #949494;">07:26:15</span>    <span style="text-decoration: underline;">1</span>136</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2012-08-18 <span style="color: #949494;">19:26:31</span>    <span style="text-decoration: underline;">1</span>038</span></span>
<span></span>
<span><span class="co"># unnest data</span></span>
<span><span class="va">df_unnested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_verbose.html">unnest_verbose</a></span><span class="op">(</span><span class="va">df_nested</span>, <span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start unnesting...</span></span>
<span><span class="co">#&gt; ✅ Finish unnesting!</span></span>
<span><span class="co">#&gt; ⌛ Unnesting time: 0.015 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_unnested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;       u_id created_at          grid_id</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 2016-04-17 <span style="color: #949494;">22:43:06</span>    <span style="text-decoration: underline;">1</span>581</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 2014-02-07 <span style="color: #949494;">07:26:15</span>    <span style="text-decoration: underline;">1</span>136</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 92<span style="text-decoration: underline;">298</span>565 2012-08-18 <span style="color: #949494;">19:26:31</span>    <span style="text-decoration: underline;">1</span>038</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="double-nest-and-double-unnest">Double nest and Double unnest<a class="anchor" aria-label="anchor" href="#double-nest-and-double-unnest"></a>
</h4>
<p>The <code>nest_double_nest()</code> and
<code><a href="../reference/unnest_double_nested.html">unnest_double_nested()</a></code> functions work in a similar way as
<code><a href="../reference/nest_verbose.html">nest_verbose()</a></code> and <code><a href="../reference/unnest_verbose.html">unnest_verbose()</a></code> functions
but they apply to an already nested data frame. In other words, they map
<code>nest</code> and <code>unnest</code> function to each element of a
list created a double-nested data frame, or vice versa. This is an
essential step in many home location algorithms as they often operate
‘per user, per location’.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>...</code>: for <code>nest_double_nest()</code> refers to
selected columns to nest and for <code><a href="../reference/unnest_double_nested.html">unnest_double_nested()</a></code>
refers to list-column to unnest.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># double nest data (e.g., nesting column: created_at)</span></span>
<span><span class="va">df_double_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nest_nested.html">nest_nested</a></span><span class="op">(</span><span class="va">df_nested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"created_at"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `progress_estimated()` was deprecated in dplyr 1.0.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">homelocator</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; 🛠 Start nesting...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish nesting!</span></span>
<span><span class="co">#&gt; ⌛ Nesting time: 0.79 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_double_nested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data              </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [200 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 33<span style="text-decoration: underline;">908</span>340 <span style="color: #949494;">&lt;tibble [83 × 2]&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 11<span style="text-decoration: underline;">616</span>678 <span style="color: #949494;">&lt;tibble [61 × 2]&gt;</span></span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_double_nested</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   grid_id data            </span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    <span style="text-decoration: underline;">1</span>581 <span style="color: #949494;">&lt;tibble [3 × 1]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    <span style="text-decoration: underline;">1</span>136 <span style="color: #949494;">&lt;tibble [7 × 1]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    <span style="text-decoration: underline;">1</span>038 <span style="color: #949494;">&lt;tibble [8 × 1]&gt;</span></span></span>
<span></span>
<span><span class="va">df_double_nested</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt;   created_at         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2016-04-17 <span style="color: #949494;">22:43:06</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2014-12-28 <span style="color: #949494;">03:26:34</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2014-12-03 <span style="color: #949494;">09:26:36</span></span></span>
<span></span>
<span><span class="co"># unnest nested data </span></span>
<span><span class="va">df_double_unnested</span> <span class="op">&lt;-</span> <span class="va">df_double_nested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co">## take first 100 rows for example</span></span>
<span>  <span class="fu"><a href="../reference/unnest_double_nested.html">unnest_double_nested</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">data</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 🛠 Start unnesting...</span></span>
<span><span class="co">#&gt; ✅ Finish unnesting!</span></span>
<span><span class="co">#&gt; ⌛ Unnesting time: 0.702 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_double_unnested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;       u_id grid_id created_at         </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565    <span style="text-decoration: underline;">1</span>581 2016-04-17 <span style="color: #949494;">22:43:06</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565    <span style="text-decoration: underline;">1</span>581 2014-12-28 <span style="color: #949494;">03:26:34</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 92<span style="text-decoration: underline;">298</span>565    <span style="text-decoration: underline;">1</span>581 2014-12-03 <span style="color: #949494;">09:26:36</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="enrich-timestamp">Enrich timestamp<a class="anchor" aria-label="anchor" href="#enrich-timestamp"></a>
</h4>
<p>The <code><a href="../reference/enrich_timestamp.html">enrich_timestamp()</a></code> function creates additional
variables that are derived from the timestamp column. These include the
year, month, day, day of the week and hour of the day. These are often
used/needed as intermediate variables in home location algorithms.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>timestamp</code>: name of column that holds the specific
timestamp for each data point. This timestamp should be in
<code>POSIXct</code> format.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#original variables </span></span>
<span><span class="va">df_nested</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;       u_id created_at          grid_id</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 2016-04-17 <span style="color: #949494;">22:43:06</span>    <span style="text-decoration: underline;">1</span>581</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 2014-02-07 <span style="color: #949494;">07:26:15</span>    <span style="text-decoration: underline;">1</span>136</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 92<span style="text-decoration: underline;">298</span>565 2012-08-18 <span style="color: #949494;">19:26:31</span>    <span style="text-decoration: underline;">1</span>038</span></span>
<span></span>
<span><span class="co"># create new variables from "created_at" timestamp column </span></span>
<span><span class="va">df_enriched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enrich_timestamp.html">enrich_timestamp</a></span><span class="op">(</span><span class="va">df_nested</span>, timestamp <span class="op">=</span> <span class="st">"created_at"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Enriching variables from timestamp...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish enriching! New added variables: year, month, day, wday, hour, ymd.</span></span>
<span><span class="co">#&gt; ⌛ Enriching time: 0.262 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_enriched</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">#&gt;       u_id created_at          grid_id  year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 2016-04-17 <span style="color: #949494;">22:43:06</span>    <span style="text-decoration: underline;">1</span>581  <span style="text-decoration: underline;">2</span>016     4    17     1    22 2016-04-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 2014-02-07 <span style="color: #949494;">07:26:15</span>    <span style="text-decoration: underline;">1</span>136  <span style="text-decoration: underline;">2</span>014     2     7     6     7 2014-02-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 92<span style="text-decoration: underline;">298</span>565 2012-08-18 <span style="color: #949494;">19:26:31</span>    <span style="text-decoration: underline;">1</span>038  <span style="text-decoration: underline;">2</span>012     8    18     7    19 2012-08-18</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="summarize-in-nested-and-double-nested-dataframe">Summarize in nested and double nested dataframe<a class="anchor" aria-label="anchor" href="#summarize-in-nested-and-double-nested-dataframe"></a>
</h4>
<p>The <code><a href="../reference/summarise_nested.html">summarise_nested()</a></code> function works similar to dplyr’s
regular <code>summarise</code> function but operates within a nested
tibble. <code><a href="../reference/summarise_double_nested.html">summarise_double_nested()</a></code> conversely operates
within a double-nested tibble.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>nest_cols</code>: a selection of columns to nest in existing
list-column</li>
<li>
<code>...</code>: name-value pairs of summary functions</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summarize in nested dataframe </span></span>
<span><span class="co"># e.g., summarise total number of tweets and total number of places per user</span></span>
<span><span class="va">df_summarize_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarise_nested.html">summarise_nested</a></span><span class="op">(</span><span class="va">df_enriched</span>, </span>
<span>                                        n_tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                        n_locs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">grid_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start summarising values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish summarising! There are 2 new added variables: n_tweets, n_locs</span></span>
<span><span class="co">#&gt; ⌛ Summarising time: 0.101 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_summarize_nested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;       u_id data                 n_tweets n_locs</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [1,291 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>291    200</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 33<span style="text-decoration: underline;">908</span>340 <span style="color: #949494;">&lt;tibble [1,170 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>170     83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 11<span style="text-decoration: underline;">616</span>678 <span style="color: #949494;">&lt;tibble [938 × 8]&gt;</span>        938     61</span></span>
<span></span>
<span><span class="co"># summarize in double nested dataframe </span></span>
<span><span class="co"># take first 100 users for example</span></span>
<span><span class="co"># e.g summarise total number of tweets and totla number of distinct days </span></span>
<span><span class="va">df_summarize_double_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarise_double_nested.html">summarise_double_nested</a></span><span class="op">(</span><span class="va">df_enriched</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>                    nest_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"created_at"</span>, <span class="st">"ymd"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"wday"</span>, <span class="st">"hour"</span><span class="op">)</span>, </span>
<span>                    n_tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, n_days <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">ymd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start summarising values...</span></span>
<span><span class="co">#&gt; ✅ Finish summarising! There are 2 new added variables: n_tweets, n_days</span></span>
<span><span class="co">#&gt; ⌛ Summarising time: 3.919 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_summarize_double_nested</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data              </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [200 × 4]&gt;</span></span></span>
<span><span class="va">df_summarize_double_nested</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;   grid_id data             n_tweets n_days</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    <span style="text-decoration: underline;">1</span>581 <span style="color: #949494;">&lt;tibble [3 × 7]&gt;</span>        3      3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    <span style="text-decoration: underline;">1</span>136 <span style="color: #949494;">&lt;tibble [7 × 7]&gt;</span>        7      6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    <span style="text-decoration: underline;">1</span>038 <span style="color: #949494;">&lt;tibble [8 × 7]&gt;</span>        8      3</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remove-active-users">Remove active users<a class="anchor" aria-label="anchor" href="#remove-active-users"></a>
</h4>
<p>The <code><a href="../reference/remove_top_users.html">remove_top_users()</a></code> function allows to remove top
<code>N</code> percent of active users based on the total number of data
points per user. Although the majority of users are real people, some
accounts are run by algorithms or ‘bots’, whereas others can be
considered as spam accounts. Removing a certain top <code>N</code>
percent of active users is an oft-used approach to remove such accounts
and reduce the number of such users in the final dataset.</p>
<ul>
<li>
<code>df</code>: a dataframe with columns of user id, and data point
counts</li>
<li>
<code>user</code>: name of column that holds unique identifier for
each user</li>
<li>
<code>counts</code>: name of column that holds the data points
frequency for each user<br>
</li>
<li>
<code>topNpct_user</code>: a decimal number that represent the
certain percentage of users to remove</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove top 1% active users (e.g based on the frequency of tweets sent by users)</span></span>
<span><span class="va">df_removed_active_users</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_top_users.html">remove_top_users</a></span><span class="op">(</span><span class="va">df_summarize_nested</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, </span>
<span>                                            counts <span class="op">=</span> <span class="st">"n_tweets"</span>, topNpct_user <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 👤 There are 100 users at this moment.</span></span>
<span><span class="co">#&gt; 👤 Skip removing active users</span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_removed_active_users</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;       u_id data                 n_tweets n_locs</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 <span style="color: #949494;">&lt;tibble [1,688 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>688    233</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [1,291 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>291    200</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 <span style="color: #949494;">&lt;tibble [1,210 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>210     79</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filter">Filter<a class="anchor" aria-label="anchor" href="#filter"></a>
</h4>
<p>The <code><a href="../reference/filter_verbose.html">filter_verbose()</a></code> function works in the same way as
<a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/filter" class="external-link">filter</a>
function in <a href="https://github.com/tidyverse/tidyverse" class="external-link">tidyverse</a> but with
additional information about the number of (filtered) users remaining in
the dataset. And the <code><a href="../reference/filter_nested.html">filter_nested()</a></code> function works in the
similar way as <code><a href="../reference/filter_verbose.html">filter_verbose()</a></code> but is applied within a
nested tibble.</p>
<ul>
<li>
<code>df</code>: a dataframe with columns of user id, and variables
that your are going to apply the filter function. If the column not in
the dataset, you need to add that column before you apply the
filter</li>
<li>
<code>user</code>: name of column that holds unique identifier for
each user</li>
<li>
<code>...</code>: Logical predicates defined in terms of the
variables in df. Only rows match conditions are kept.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter users with less than 10 tweets sent at less than 10 places </span></span>
<span><span class="va">df_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_verbose.html">filter_verbose</a></span><span class="op">(</span><span class="va">df_removed_active_users</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, </span>
<span>                              <span class="va">n_tweets</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">n_locs</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; 👤 There are 100 users at this moment.</span></span>
<span><span class="co">#&gt; 🛠 Start filtering users...</span></span>
<span><span class="co">#&gt; ✅ Finish filtering! Filterred 36 users!</span></span>
<span><span class="co">#&gt; 👤 There are 64 users left.</span></span>
<span><span class="co">#&gt; ⌛ Filtering time: 0.002 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;       u_id data                 n_tweets n_locs</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 <span style="color: #949494;">&lt;tibble [1,688 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>688    233</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [1,291 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>291    200</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 <span style="color: #949494;">&lt;tibble [1,210 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>210     79</span></span>
<span></span>
<span><span class="co"># filter tweets that sent on weekends and during daytime (8am to 6pm)</span></span>
<span><span class="va">df_filter_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_nested.html">filter_nested</a></span><span class="op">(</span><span class="va">df_filtered</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, </span>
<span>                                  <span class="op">!</span><span class="va">wday</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span>, <span class="co"># 1 means Sunday and 7 means Saturday</span></span>
<span>                                  <span class="op">!</span><span class="va">hour</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">18</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 👤 There are 64 users at this moment.</span></span>
<span><span class="co">#&gt; 🛠 Start filtering user...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish Filtering! Filterred 0 users!</span></span>
<span><span class="co">#&gt; 👤 There are 64 users left!</span></span>
<span><span class="co">#&gt; ⌛ Filtering time: 0.072 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_filter_nested</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;       u_id data               n_tweets n_locs</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 <span style="color: #949494;">&lt;tibble [495 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>688    233</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [424 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>291    200</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 <span style="color: #949494;">&lt;tibble [463 × 8]&gt;</span>     <span style="text-decoration: underline;">1</span>210     79</span></span>
<span></span>
<span><span class="va">df_filter_nested</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 8</span></span></span>
<span><span class="co">#&gt;   created_at          grid_id  year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2016-06-23 <span style="color: #949494;">00:36:25</span>     759  <span style="text-decoration: underline;">2</span>016     6    23     5     0 2016-06-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2015-02-17 <span style="color: #949494;">19:14:10</span>     778  <span style="text-decoration: underline;">2</span>015     2    17     3    19 2015-02-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2015-03-31 <span style="color: #949494;">23:21:51</span>     759  <span style="text-decoration: underline;">2</span>015     3    31     3    23 2015-03-31</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mutate">Mutate<a class="anchor" aria-label="anchor" href="#mutate"></a>
</h4>
<p>The <code><a href="../reference/mutate_verbose.html">mutate_verbose()</a></code> function works in the same way as
<a href="https://www.rdocumentation.org/packages/dplyr/versions/0.5.0/topics/mutate" class="external-link">mutate</a>
function in <a href="https://github.com/tidyverse/tidyverse" class="external-link">tidyverse</a> but with
additional information about the elapsed running time.</p>
<ul>
<li>
<code>df</code>: a dataframe</li>
<li>
<code>...</code>: name-value pairs of expressions</li>
</ul>
<p>Function <code><a href="../reference/mutate_nested.html">mutate_nested()</a></code> works in the similar way as
<code><a href="../reference/mutate_verbose.html">mutate_verbose()</a></code> but it adds new variables inside a nested
tibble.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>...</code>: name-value pairs of expressions</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## let's use pre-discussed functions to filter some users first </span></span>
<span><span class="va">colnmaes_data</span> <span class="op">&lt;-</span> <span class="va">df_filtered</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">colnmaes_to_nest</span> <span class="op">&lt;-</span> <span class="va">colnmaes_data</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">colnmaes_data</span> <span class="op">==</span> <span class="st">"grid_id"</span><span class="op">)</span><span class="op">]</span> </span>
<span></span>
<span><span class="va">df_cleaned</span> <span class="op">&lt;-</span> <span class="va">df_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/summarise_double_nested.html">summarise_double_nested</a></span><span class="op">(</span><span class="va">.</span>, nest_cols <span class="op">=</span> <span class="va">colnmaes_to_nest</span>,</span>
<span>                          n_tweets_loc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># number of tweets sent at each location</span></span>
<span>                          n_hrs_loc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">hour</span><span class="op">)</span>, <span class="co"># number of unique hours of sent tweets </span></span>
<span>                          n_days_loc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">ymd</span><span class="op">)</span>, <span class="co"># number of unique days of sent tweets </span></span>
<span>                          period_loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span>, <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># period of tweeting </span></span>
<span>  <span class="fu"><a href="../reference/unnest_verbose.html">unnest_verbose</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/filter_verbose.html">filter_verbose</a></span><span class="op">(</span><span class="va">.</span>, user <span class="op">=</span> <span class="st">"u_id"</span>,</span>
<span>                 <span class="va">n_tweets_loc</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">n_hrs_loc</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">n_days_loc</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">period_loc</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 🛠 Start summarising values...</span></span>
<span><span class="co">#&gt; ✅ Finish summarising! There are 4 new added variables: n_tweets_loc, n_hrs_loc, n_days_loc, period_loc</span></span>
<span><span class="co">#&gt; ⌛ Summarising time: 4.545 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 🛠 Start unnesting...</span></span>
<span><span class="co">#&gt; ✅ Finish unnesting!</span></span>
<span><span class="co">#&gt; ⌛ Unnesting time: 0.009 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 👤 There are 64 users at this moment.</span></span>
<span><span class="co">#&gt; 🛠 Start filtering users...</span></span>
<span><span class="co">#&gt; ✅ Finish filtering! Filterred 35 users!</span></span>
<span><span class="co">#&gt; 👤 There are 29 users left.</span></span>
<span><span class="co">#&gt; ⌛ Filtering time: 0.002 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span>  </span>
<span><span class="co"># show cleaned dataset </span></span>
<span><span class="va">df_cleaned</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">#&gt;       u_id n_tweets n_locs grid_id data     n_tweets_loc n_hrs_loc n_days_loc</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     759 <span style="color: #949494;">&lt;tibble&gt;</span>          467        23        366</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     842 <span style="color: #949494;">&lt;tibble&gt;</span>           57        16         51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>212 <span style="color: #949494;">&lt;tibble&gt;</span>           71        13         59</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: period_loc &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co"># ok, then let's apply the mutate_nested function to add four new variables: wd_or_wk, time_numeric, rest_or_work, wk.am_or_wk.pm</span></span>
<span><span class="va">df_expanded</span> <span class="op">&lt;-</span> <span class="va">df_cleaned</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/mutate_nested.html">mutate_nested</a></span><span class="op">(</span>wd_or_wk <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">wday</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span><span class="op">)</span>, <span class="st">"weekend"</span>, <span class="st">"weekday"</span><span class="op">)</span>,</span>
<span>                time_numeric <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html" class="external-link">hour</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span> <span class="op">+</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/minute.html" class="external-link">minute</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span> <span class="op">+</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/second.html" class="external-link">second</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3600</span>, </span>
<span>                rest_or_work <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">time_numeric</span> <span class="op">&gt;=</span> <span class="fl">9</span> <span class="op">&amp;</span> <span class="va">time_numeric</span> <span class="op">&lt;=</span> <span class="fl">18</span>, <span class="st">"work"</span>, <span class="st">"rest"</span><span class="op">)</span>, </span>
<span>                wk.am_or_wk.pm <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">time_numeric</span> <span class="op">&gt;=</span> <span class="fl">6</span> <span class="op">&amp;</span> <span class="va">time_numeric</span> <span class="op">&lt;=</span> <span class="fl">12</span> <span class="op">&amp;</span> <span class="va">wd_or_wk</span> <span class="op">==</span> <span class="st">"weekend"</span>, <span class="st">"weekend_am"</span>, <span class="st">"weekend_pm"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 🛠 Start adding variable(s)...</span></span>
<span><span class="co">#&gt; ✅ Finish adding! There are 4 new added variables: wd_or_wk, time_numeric, rest_or_work, wk.am_or_wk.pm</span></span>
<span><span class="co">#&gt; ⌛ Adding time: 0.255 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_expanded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">#&gt;       u_id n_tweets n_locs grid_id data     n_tweets_loc n_hrs_loc n_days_loc</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     759 <span style="color: #949494;">&lt;tibble&gt;</span>          467        23        366</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     842 <span style="color: #949494;">&lt;tibble&gt;</span>           57        16         51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>212 <span style="color: #949494;">&lt;tibble&gt;</span>           71        13         59</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: period_loc &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The function <code><a href="../reference/prop_factor_nested.html">prop_factor_nested()</a></code> allows you to
calculate the proportion of categories for a variable inside the
list-column and convert each categories to a new variable adding to the
dataframe. For example, inside the list-column, the variable
<code>wd_or_wk</code> has two categories named weekend or weekday, when
you call <code><a href="../reference/prop_factor_nested.html">prop_factor_nested()</a></code> function, it calculates the
proportion of weekend and weekday separately, and the results are then
expanded to two new columns called <code>weekday</code> and
<code>weekend</code> adding to the dataframe.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>var</code>: name of column to calculate inside the
list-column</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># categories for a variable inside the list-column: e.g weekend or weekday</span></span>
<span><span class="va">df_expanded</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">#&gt;   created_at           year month   day  wday  hour ymd    wd_or_wk time_numeric</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2016-06-23 <span style="color: #949494;">00:36:25</span>  <span style="text-decoration: underline;">2</span>016     6    23     5     0 2016-… weekday         0.607</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2014-09-03 <span style="color: #949494;">15:46:45</span>  <span style="text-decoration: underline;">2</span>014     9     3     4    15 2014-… weekday        15.8  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2015-03-31 <span style="color: #949494;">23:21:51</span>  <span style="text-decoration: underline;">2</span>015     3    31     3    23 2015-… weekday        23.4  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: rest_or_work &lt;chr&gt;, wk.am_or_wk.pm &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="co"># calculate proportion of categories for four variables: wd_or_wk, rest_or_work, wk.am_or_wk.pm</span></span>
<span><span class="va">df_expanded</span> <span class="op">&lt;-</span> <span class="va">df_expanded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/prop_factor_nested.html">prop_factor_nested</a></span><span class="op">(</span><span class="va">wd_or_wk</span>, <span class="va">rest_or_work</span>, <span class="va">wk.am_or_wk.pm</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 🛠 Start calculating proportion...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish calculating! There are 6 new calculated variables: rest, weekday, weekend, weekend_am, weekend_pm, work</span></span>
<span><span class="co">#&gt; ⌛ Calculating time: 1.839 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># show result </span></span>
<span><span class="va">df_expanded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 15</span></span></span>
<span><span class="co">#&gt;       u_id n_tweets n_locs grid_id data     n_tweets_loc n_hrs_loc n_days_loc</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     759 <span style="color: #949494;">&lt;tibble&gt;</span>          467        23        366</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     842 <span style="color: #949494;">&lt;tibble&gt;</span>           57        16         51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>212 <span style="color: #949494;">&lt;tibble&gt;</span>           71        13         59</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: period_loc &lt;dbl&gt;, rest &lt;dbl&gt;, weekday &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   weekend &lt;dbl&gt;, weekend_am &lt;dbl&gt;, weekend_pm &lt;dbl&gt;, work &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="score">Score<a class="anchor" aria-label="anchor" href="#score"></a>
</h4>
<p>The <code><a href="../reference/score_nested.html">score_nested()</a></code> function allows you to give a
weighted value for one or more variables in a nested dataframe.</p>
<ul>
<li>
<code>df</code>: a nested dataframe by user</li>
<li>
<code>user</code>: name of column that holds unique identifier for
each user</li>
<li>
<code>location</code>: name of column that holds unique identifier
for each location</li>
<li>
<code>keep_ori_vars</code>: option to keep or drop original
varialbes</li>
<li>
<code>...</code>: name-value pairs of expression</li>
</ul>
<p>The <code><a href="../reference/score_summary.html">score_summary()</a></code> function summarises all scored
columns and return one single summary score per row.</p>
<ul>
<li>
<code>df</code>: a dataframe</li>
<li>
<code>user</code>: name of column that holds unique identifier for
each user</li>
<li>
<code>location</code>: name of column that holds unique identifier
for each location</li>
<li>
<code>...</code>: name of scored columns</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## let's add two more variables before we do the scoring </span></span>
<span><span class="va">df_expanded</span> <span class="op">&lt;-</span> <span class="va">df_expanded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/summarise_nested.html">summarise_nested</a></span><span class="op">(</span>n_wdays_loc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">wday</span><span class="op">)</span>,</span>
<span>                   n_months_loc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start summarising values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish summarising! There are 2 new added variables: n_wdays_loc, n_months_loc</span></span>
<span><span class="co">#&gt; ⌛ Summarising time: 0.113 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_expanded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 17</span></span></span>
<span><span class="co">#&gt;       u_id n_tweets n_locs grid_id data     n_tweets_loc n_hrs_loc n_days_loc</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     759 <span style="color: #949494;">&lt;tibble&gt;</span>          467        23        366</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233     842 <span style="color: #949494;">&lt;tibble&gt;</span>           57        16         51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 40<span style="text-decoration: underline;">153</span>763     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>212 <span style="color: #949494;">&lt;tibble&gt;</span>           71        13         59</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: period_loc &lt;dbl&gt;, rest &lt;dbl&gt;, weekday &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   weekend &lt;dbl&gt;, weekend_am &lt;dbl&gt;, weekend_pm &lt;dbl&gt;, work &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n_wdays_loc &lt;int&gt;, n_months_loc &lt;int&gt;</span></span></span>
<span></span>
<span><span class="co"># when calculating scores, you can give weight to different variables, but the total weight should add up to 1</span></span>
<span><span class="va">df_scored</span> <span class="op">&lt;-</span> <span class="va">df_expanded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/score_nested.html">score_nested</a></span><span class="op">(</span><span class="va">.</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, location <span class="op">=</span> <span class="st">"grid_id"</span>, keep_original_vars <span class="op">=</span> <span class="cn">F</span>,</span>
<span>               s_n_tweets_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_tweets_loc</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_tweets_loc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               s_n_hrs_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_hrs_loc</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span>, </span>
<span>               s_n_days_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_days_loc</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_days_loc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               s_period_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">period_loc</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">period_loc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               s_n_wdays_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_wdays_loc</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>               s_n_months_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_months_loc</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>               s_weekend <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">weekend</span><span class="op">)</span>,</span>
<span>               s_rest <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="op">(</span><span class="va">rest</span><span class="op">)</span>,</span>
<span>               s_wk_am <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">weekend_am</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start scoring ...</span></span>
<span><span class="co">#&gt; ✅ Finish scoring! There are 9 new added variables: s_n_tweets_loc, s_n_hrs_loc, s_n_days_loc, s_period_loc, s_n_wdays_loc, s_n_months_loc, s_weekend, s_rest, s_wk_am</span></span>
<span><span class="co">#&gt; ⌛ Scoring time: 0.199 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_scored</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data              </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 <span style="color: #949494;">&lt;tibble [12 × 10]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [11 × 10]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 <span style="color: #949494;">&lt;tibble [4 × 10]&gt;</span></span></span>
<span><span class="va">df_scored</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 10</span></span></span>
<span><span class="co">#&gt;    grid_id s_n_tweets_loc s_n_hrs_loc s_n_days_loc s_period_loc s_n_wdays_loc</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     759        0.1          0.095<span style="text-decoration: underline;">8</span>      0.1           0.093<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     842        0.012<span style="text-decoration: underline;">2</span>       0.066<span style="text-decoration: underline;">7</span>      0.013<span style="text-decoration: underline;">9</span>        0.1           0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    <span style="text-decoration: underline;">1</span>212        0.015<span style="text-decoration: underline;">2</span>       0.054<span style="text-decoration: underline;">2</span>      0.016<span style="text-decoration: underline;">1</span>        0.022<span style="text-decoration: underline;">5</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     593        0.013<span style="text-decoration: underline;">3</span>       0.058<span style="text-decoration: underline;">3</span>      0.014<span style="text-decoration: underline;">2</span>        0.086<span style="text-decoration: underline;">3</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    <span style="text-decoration: underline;">1</span>125        0.006<span style="text-decoration: underline;">00</span>      0.054<span style="text-decoration: underline;">2</span>      0.006<span style="text-decoration: underline;">56</span>       0.077<span style="text-decoration: underline;">8</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     797        0.008<span style="text-decoration: underline;">35</span>      0.066<span style="text-decoration: underline;">7</span>      0.010<span style="text-decoration: underline;">4</span>        0.085<span style="text-decoration: underline;">1</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     843        0.027<span style="text-decoration: underline;">4</span>       0.058<span style="text-decoration: underline;">3</span>      0.030<span style="text-decoration: underline;">1</span>        0.069<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     862        0.027<span style="text-decoration: underline;">8</span>       0.058<span style="text-decoration: underline;">3</span>      0.029<span style="text-decoration: underline;">5</span>        0.072<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    <span style="text-decoration: underline;">1</span>709        0.003<span style="text-decoration: underline;">43</span>      0.054<span style="text-decoration: underline;">2</span>      0.004<span style="text-decoration: underline;">37</span>       0.087<span style="text-decoration: underline;">0</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    <span style="text-decoration: underline;">1</span>174        0.008<span style="text-decoration: underline;">35</span>      0.054<span style="text-decoration: underline;">2</span>      0.010<span style="text-decoration: underline;">1</span>        0.075<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     614        0.003<span style="text-decoration: underline;">21</span>      0.054<span style="text-decoration: underline;">2</span>      0.004<span style="text-decoration: underline;">10</span>       0.098<span style="text-decoration: underline;">6</span>        0.071<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    <span style="text-decoration: underline;">1</span>038        0.004<span style="text-decoration: underline;">28</span>      0.045<span style="text-decoration: underline;">8</span>      0.005<span style="text-decoration: underline;">19</span>       0.078<span style="text-decoration: underline;">4</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   s_wk_am &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co">### we can replace the score function by mutate function </span></span>
<span><span class="va">df_scored_2</span> <span class="op">&lt;-</span> <span class="va">df_expanded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/nest_verbose.html">nest_verbose</a></span><span class="op">(</span><span class="op">-</span><span class="va">u_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/mutate_nested.html">mutate_nested</a></span><span class="op">(</span>s_n_tweets_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_tweets_loc</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_tweets_loc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                s_n_hrs_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_hrs_loc</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span>, </span>
<span>                s_n_days_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_days_loc</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_days_loc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                s_period_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">period_loc</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">period_loc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                s_n_wdays_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_wdays_loc</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>                s_n_months_loc <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_months_loc</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>                s_weekend <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">weekend</span><span class="op">)</span>,</span>
<span>                s_rest <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="op">(</span><span class="va">rest</span><span class="op">)</span>,</span>
<span>                s_wk_am <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">weekend_am</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start nesting...</span></span>
<span><span class="co">#&gt; ✅ Finish nesting!</span></span>
<span><span class="co">#&gt; ⌛ Nesting time: 0.009 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 🛠 Start adding variable(s)...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish adding! There are 9 new added variables: s_n_tweets_loc, s_n_hrs_loc, s_n_days_loc, s_period_loc, s_n_wdays_loc, s_n_months_loc, s_weekend, s_rest, s_wk_am</span></span>
<span><span class="co">#&gt; ⌛ Adding time: 0.069 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_scored_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data              </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 <span style="color: #949494;">&lt;tibble [12 × 25]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [11 × 25]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 <span style="color: #949494;">&lt;tibble [4 × 25]&gt;</span></span></span>
<span><span class="va">df_scored_2</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 25</span></span></span>
<span><span class="co">#&gt;    n_tweets n_locs grid_id data     n_tweets_loc n_hrs_loc n_days_loc period_loc</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     <span style="text-decoration: underline;">1</span>688    233     759 <span style="color: #949494;">&lt;tibble&gt;</span>          467        23        366      <span style="text-decoration: underline;">1</span>211.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     <span style="text-decoration: underline;">1</span>688    233     842 <span style="color: #949494;">&lt;tibble&gt;</span>           57        16         51      <span style="text-decoration: underline;">1</span>300.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>212 <span style="color: #949494;">&lt;tibble&gt;</span>           71        13         59       292.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     <span style="text-decoration: underline;">1</span>688    233     593 <span style="color: #949494;">&lt;tibble&gt;</span>           62        14         52      <span style="text-decoration: underline;">1</span>121.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>125 <span style="color: #949494;">&lt;tibble&gt;</span>           28        13         24      <span style="text-decoration: underline;">1</span>011.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     <span style="text-decoration: underline;">1</span>688    233     797 <span style="color: #949494;">&lt;tibble&gt;</span>           39        16         38      <span style="text-decoration: underline;">1</span>106.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     <span style="text-decoration: underline;">1</span>688    233     843 <span style="color: #949494;">&lt;tibble&gt;</span>          128        14        110       900.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     <span style="text-decoration: underline;">1</span>688    233     862 <span style="color: #949494;">&lt;tibble&gt;</span>          130        14        108       938.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>709 <span style="color: #949494;">&lt;tibble&gt;</span>           16        13         16      <span style="text-decoration: underline;">1</span>130.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>174 <span style="color: #949494;">&lt;tibble&gt;</span>           39        13         37       977.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     <span style="text-decoration: underline;">1</span>688    233     614 <span style="color: #949494;">&lt;tibble&gt;</span>           15        13         15      <span style="text-decoration: underline;">1</span>281.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     <span style="text-decoration: underline;">1</span>688    233    <span style="text-decoration: underline;">1</span>038 <span style="color: #949494;">&lt;tibble&gt;</span>           20        11         19      <span style="text-decoration: underline;">1</span>018.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more variables: rest &lt;dbl&gt;, weekday &lt;dbl&gt;, weekend &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   weekend_am &lt;dbl&gt;, weekend_pm &lt;dbl&gt;, work &lt;dbl&gt;, n_wdays_loc &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n_months_loc &lt;int&gt;, s_n_tweets_loc &lt;dbl&gt;, s_n_hrs_loc &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   s_n_days_loc &lt;dbl&gt;, s_period_loc &lt;dbl&gt;, s_n_wdays_loc &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;, s_wk_am &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sum varialbes score for each location </span></span>
<span><span class="va">df_score_summed</span> <span class="op">&lt;-</span> <span class="va">df_scored</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/score_summary.html">score_summary</a></span><span class="op">(</span><span class="va">.</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, location <span class="op">=</span> <span class="st">"grid_id"</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"s_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start summing scores...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish summing! There are 1 new added variables: score</span></span>
<span><span class="co">#&gt; ⌛ Summing time: 0.088 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_score_summed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data              </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 <span style="color: #949494;">&lt;tibble [12 × 11]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [11 × 11]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 <span style="color: #949494;">&lt;tibble [4 × 11]&gt;</span></span></span>
<span><span class="va">df_score_summed</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 11</span></span></span>
<span><span class="co">#&gt;    grid_id s_n_tweets_loc s_n_hrs_loc s_n_days_loc s_period_loc s_n_wdays_loc</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     759        0.1          0.095<span style="text-decoration: underline;">8</span>      0.1           0.093<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     842        0.012<span style="text-decoration: underline;">2</span>       0.066<span style="text-decoration: underline;">7</span>      0.013<span style="text-decoration: underline;">9</span>        0.1           0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    <span style="text-decoration: underline;">1</span>212        0.015<span style="text-decoration: underline;">2</span>       0.054<span style="text-decoration: underline;">2</span>      0.016<span style="text-decoration: underline;">1</span>        0.022<span style="text-decoration: underline;">5</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     593        0.013<span style="text-decoration: underline;">3</span>       0.058<span style="text-decoration: underline;">3</span>      0.014<span style="text-decoration: underline;">2</span>        0.086<span style="text-decoration: underline;">3</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    <span style="text-decoration: underline;">1</span>125        0.006<span style="text-decoration: underline;">00</span>      0.054<span style="text-decoration: underline;">2</span>      0.006<span style="text-decoration: underline;">56</span>       0.077<span style="text-decoration: underline;">8</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     797        0.008<span style="text-decoration: underline;">35</span>      0.066<span style="text-decoration: underline;">7</span>      0.010<span style="text-decoration: underline;">4</span>        0.085<span style="text-decoration: underline;">1</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     843        0.027<span style="text-decoration: underline;">4</span>       0.058<span style="text-decoration: underline;">3</span>      0.030<span style="text-decoration: underline;">1</span>        0.069<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     862        0.027<span style="text-decoration: underline;">8</span>       0.058<span style="text-decoration: underline;">3</span>      0.029<span style="text-decoration: underline;">5</span>        0.072<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    <span style="text-decoration: underline;">1</span>709        0.003<span style="text-decoration: underline;">43</span>      0.054<span style="text-decoration: underline;">2</span>      0.004<span style="text-decoration: underline;">37</span>       0.087<span style="text-decoration: underline;">0</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    <span style="text-decoration: underline;">1</span>174        0.008<span style="text-decoration: underline;">35</span>      0.054<span style="text-decoration: underline;">2</span>      0.010<span style="text-decoration: underline;">1</span>        0.075<span style="text-decoration: underline;">2</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     614        0.003<span style="text-decoration: underline;">21</span>      0.054<span style="text-decoration: underline;">2</span>      0.004<span style="text-decoration: underline;">10</span>       0.098<span style="text-decoration: underline;">6</span>        0.071<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    <span style="text-decoration: underline;">1</span>038        0.004<span style="text-decoration: underline;">28</span>      0.045<span style="text-decoration: underline;">8</span>      0.005<span style="text-decoration: underline;">19</span>       0.078<span style="text-decoration: underline;">4</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   s_wk_am &lt;dbl&gt;, score &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-locations">Extract locations<a class="anchor" aria-label="anchor" href="#extract-locations"></a>
</h4>
<p>The <code><a href="../reference/extract_location.html">extract_location()</a></code> function allows you to sort the
locations of each each user based on descending value of selected
column, and return the top N location(s) for each user. The extracted
location(s) then represent the most likely home location of the
user.</p>
<ul>
<li>
<code>df</code>: a nested dataframe by user</li>
<li>
<code>user</code>: name of column that holds unique identifier for
each user</li>
<li>
<code>location</code>: name of column that holds unique identifier
for each location</li>
<li>
<code>show_n_loc</code>: a single number that decides the number of
locations to be extracted</li>
<li>
<code>keep_score</code>: option to keep or remove columns with
scored value</li>
<li>
<code>...</code>: name of column(s) that used to sort the
locations</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract homes for users based on score value (each user return 1 most possible home)</span></span>
<span><span class="va">df_home</span> <span class="op">&lt;-</span> <span class="va">df_score_summed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/extract_location.html">extract_location</a></span><span class="op">(</span><span class="va">.</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, location <span class="op">=</span> <span class="st">"grid_id"</span>, show_n_loc <span class="op">=</span> <span class="fl">1</span>, keep_score <span class="op">=</span> <span class="cn">F</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start extracting homes for users...</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `dplyr::mutate()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `home = purrr::map_chr(df[[colname_nested_data]],</span></span>
<span><span class="co">#&gt;   ~get_loc_with_progress(.))`.</span></span>
<span><span class="co">#&gt; Caused by warning:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Automatic coercion from integer to character was deprecated in purrr 1.0.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use an explicit call to `as.character()` within `map_chr()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">homelocator</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 🎉 Congratulations!! Your have found 29 users' potential home(s).</span></span>
<span><span class="co">#&gt; ⌛ Extracting time: 0.194 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_home</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;       u_id home </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 759  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 1582 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 1113</span></span>
<span></span>
<span><span class="co"># extract homes for users and keep scores of locations</span></span>
<span><span class="va">df_home</span> <span class="op">&lt;-</span> <span class="va">df_score_summed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/extract_location.html">extract_location</a></span><span class="op">(</span><span class="va">.</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, location <span class="op">=</span> <span class="st">"grid_id"</span>, show_n_loc <span class="op">=</span> <span class="fl">1</span>, keep_score <span class="op">=</span> <span class="cn">T</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start extracting homes for users...</span></span>
<span><span class="co">#&gt; 🎉 Congratulations!! Your have found 29 users' potential home(s).</span></span>
<span><span class="co">#&gt; ⌛ Extracting time: 0.105 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_home</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;       u_id data               home </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 40<span style="text-decoration: underline;">153</span>763 <span style="color: #949494;">&lt;tibble [12 × 11]&gt;</span> 759  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 92<span style="text-decoration: underline;">298</span>565 <span style="color: #949494;">&lt;tibble [11 × 11]&gt;</span> 1582 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 31<span style="text-decoration: underline;">088</span>399 <span style="color: #949494;">&lt;tibble [4 × 11]&gt;</span>  1113</span></span>
<span><span class="va">df_home</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 11</span></span></span>
<span><span class="co">#&gt;   grid_id s_n_tweets_loc s_n_hrs_loc s_n_days_loc s_period_loc s_n_wdays_loc</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     880        0.077<span style="text-decoration: underline;">4</span>       0.1         0.057<span style="text-decoration: underline;">7</span>        0.079<span style="text-decoration: underline;">6</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    <span style="text-decoration: underline;">1</span>113        0.1          0.091<span style="text-decoration: underline;">7</span>      0.1           0.1           0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     862        0.051<span style="text-decoration: underline;">9</span>       0.1         0.047<span style="text-decoration: underline;">7</span>        0.071<span style="text-decoration: underline;">6</span>        0.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    <span style="text-decoration: underline;">1</span>594        0.005<span style="text-decoration: underline;">01</span>      0.05        0.008<span style="text-decoration: underline;">46</span>       0.062<span style="text-decoration: underline;">1</span>        0.071<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   s_wk_am &lt;dbl&gt;, score &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="spread">Spread<a class="anchor" aria-label="anchor" href="#spread"></a>
</h4>
<p>The <code><a href="../reference/spread_nested.html">spread_nested()</a></code> function works in the same way as <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/spread" class="external-link">spread</a>
function in <a href="https://github.com/tidyverse/tidyverse" class="external-link">tidyverse</a> but works
inside a nested data frame. It allows to spread a key-value pairs across
multiple columns.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>var_key</code>: column name or position</li>
<li>
<code>var_value</code>: column name or position</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let's add one timeframe variable first and calculate the number of data points at each timeframe</span></span>
<span><span class="va">df_timeframe</span> <span class="op">&lt;-</span> <span class="va">df_enriched</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/mutate_nested.html">mutate_nested</a></span><span class="op">(</span>timeframe <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">hour</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">hour</span> <span class="op">&lt;</span> <span class="fl">8</span>, <span class="st">"Rest"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">hour</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">hour</span> <span class="op">&lt;</span> <span class="fl">19</span>, <span class="st">"Active"</span>, <span class="st">"Leisure"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start adding variable(s)...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish adding! There are 1 new added variables: timeframe</span></span>
<span><span class="co">#&gt; ⌛ Adding time: 0.124 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">colnames_nested_data</span> <span class="op">&lt;-</span> <span class="va">df_timeframe</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">colnames_to_nest</span> <span class="op">&lt;-</span> <span class="va">colnames_nested_data</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">colnames_nested_data</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grid_id"</span>, <span class="st">"timeframe"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df_timeframe</span> <span class="op">&lt;-</span> <span class="va">df_timeframe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># take first 20 users as example</span></span>
<span>  <span class="fu"><a href="../reference/summarise_double_nested.html">summarise_double_nested</a></span><span class="op">(</span><span class="va">.</span>, nest_cols <span class="op">=</span> <span class="va">colnames_to_nest</span>, </span>
<span>                            n_points_timeframe <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 🛠 Start summarising values...</span></span>
<span><span class="co">#&gt; ✅ Finish summarising! There are 1 new added variables: n_points_timeframe</span></span>
<span><span class="co">#&gt; ⌛ Summarising time: 1.961 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="va">df_timeframe</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 102 × 4</span></span></span>
<span><span class="co">#&gt;    grid_id timeframe data               n_points_timeframe</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    <span style="text-decoration: underline;">1</span>461 Active    <span style="color: #949494;">&lt;tibble [280 × 7]&gt;</span>                280</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    <span style="text-decoration: underline;">1</span>461 Leisure   <span style="color: #949494;">&lt;tibble [173 × 7]&gt;</span>                173</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    <span style="text-decoration: underline;">1</span>461 Rest      <span style="color: #949494;">&lt;tibble [418 × 7]&gt;</span>                418</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    <span style="text-decoration: underline;">1</span>239 Active    <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>                    1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    <span style="text-decoration: underline;">1</span>460 Leisure   <span style="color: #949494;">&lt;tibble [53 × 7]&gt;</span>                  53</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    <span style="text-decoration: underline;">1</span>449 Leisure   <span style="color: #949494;">&lt;tibble [21 × 7]&gt;</span>                  21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    <span style="text-decoration: underline;">1</span>629 Leisure   <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>                    1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    <span style="text-decoration: underline;">1</span>260 Active    <span style="color: #949494;">&lt;tibble [2 × 7]&gt;</span>                    2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    <span style="text-decoration: underline;">1</span>399 Rest      <span style="color: #949494;">&lt;tibble [2 × 7]&gt;</span>                    2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    <span style="text-decoration: underline;">1</span>345 Active    <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>                    1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 92 more rows</span></span></span>
<span></span>
<span><span class="co"># spread timeframe in nested dataframe with key is timeframe and value is n_points_timeframe</span></span>
<span><span class="va">df_timeframe_spreaded</span> <span class="op">&lt;-</span> <span class="va">df_timeframe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/spread_nested.html">spread_nested</a></span><span class="op">(</span><span class="va">.</span>, key_var <span class="op">=</span> <span class="st">"timeframe"</span>, value_var <span class="op">=</span> <span class="st">"n_points_timeframe"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 🛠 Start spreading timeframe variable...</span></span>
<span><span class="co">#&gt; ✅ Finish spreading! There are 3 new added variables: Active, Leisure, Rest</span></span>
<span><span class="co">#&gt; ⌛ Spreading time: 0.278 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_timeframe_spreaded</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 102 × 5</span></span></span>
<span><span class="co">#&gt;    grid_id data             Active Leisure  Rest</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     354 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      0       1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     355 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      1       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     374 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      0       1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     597 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      0       1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     611 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      1       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     612 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      1       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     613 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      1       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     614 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      1       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     645 <span style="color: #949494;">&lt;tibble [3 × 7]&gt;</span>      3       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     645 <span style="color: #949494;">&lt;tibble [1 × 7]&gt;</span>      0       0     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 92 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="arrange">Arrange<a class="anchor" aria-label="anchor" href="#arrange"></a>
</h4>
<p>The <code><a href="../reference/arrange_nested.html">arrange_nested()</a></code> function works in the same way as
<a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/arrange" class="external-link">arrange</a>
function in <a href="https://github.com/tidyverse/tidyverse" class="external-link">tidyverse</a> but works
inside a nested data frame. It allows to sort rows by variables.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>...</code>: comma separated list of unquoted variable
names</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_enriched</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>  </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 938 × 8</span></span></span>
<span><span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2014-07-18 <span style="color: #949494;">10:08:21</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>014     7    18     6    10 2014-07-18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2013-11-24 <span style="color: #949494;">23:16:24</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013    11    24     1    23 2013-11-24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2013-06-12 <span style="color: #949494;">00:59:42</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    12     4     0 2013-06-12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2013-06-07 <span style="color: #949494;">19:56:56</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     7     6    19 2013-06-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2013-06-12 <span style="color: #949494;">01:08:29</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    12     4     1 2013-06-12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2013-06-02 <span style="color: #949494;">20:53:09</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     2     1    20 2013-06-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2013-06-10 <span style="color: #949494;">20:57:17</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    10     2    20 2013-06-10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2013-06-04 <span style="color: #949494;">17:42:06</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     4     3    17 2013-06-04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2014-07-10 <span style="color: #949494;">01:00:45</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>014     7    10     5     1 2014-07-10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2013-06-13 <span style="color: #949494;">01:48:27</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    13     5     1 2013-06-13</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 928 more rows</span></span></span>
<span></span>
<span><span class="va">df_arranged</span> <span class="op">&lt;-</span> <span class="va">df_enriched</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/arrange_nested.html">arrange_nested</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">hour</span><span class="op">)</span><span class="op">)</span> <span class="co"># arrange the hour in descending order</span></span>
<span><span class="co">#&gt; 🛠 Start sorting...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish sorting!</span></span>
<span><span class="co">#&gt; ⌛ Sorting time: 0.173 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_arranged</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 938 × 8</span></span></span>
<span><span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2013-11-24 <span style="color: #949494;">23:16:24</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013    11    24     1    23 2013-11-24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2013-06-08 <span style="color: #949494;">23:41:19</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     8     7    23 2013-06-08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2013-06-02 <span style="color: #949494;">23:21:04</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     2     1    23 2013-06-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2013-06-05 <span style="color: #949494;">23:31:59</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     5     4    23 2013-06-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2013-06-02 <span style="color: #949494;">23:29:43</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     2     1    23 2013-06-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2013-06-06 <span style="color: #949494;">23:51:50</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     6     5    23 2013-06-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2014-04-27 <span style="color: #949494;">23:40:59</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>014     4    27     1    23 2014-04-27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2013-06-05 <span style="color: #949494;">23:47:27</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     5     4    23 2013-06-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2013-06-02 <span style="color: #949494;">23:02:04</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     2     1    23 2013-06-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2013-06-06 <span style="color: #949494;">23:07:49</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     6     5    23 2013-06-06</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 928 more rows</span></span></span></code></pre></div>
<p>The <code><a href="../reference/arrange_double_nested.html">arrange_double_nested()</a></code> function works in the
similar way as <code><a href="../reference/arrange_nested.html">arrange_nested()</a></code> function, but it applies to
a double nested data frame. You need to choose the columns to nest
inside a nested dataframe and then sort rows by selected column.</p>
<pre><code>- `df`: a nested dataframe 
- `nest_cols`: name of columns to nest in existing list-column
- `...`: comma separated list of unquoted variable names </code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the name of columns to nest </span></span>
<span><span class="va">colnames_nested_data</span> <span class="op">&lt;-</span> <span class="va">df_enriched</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">colnmaes_to_nest</span> <span class="op">&lt;-</span> <span class="va">colnames_nested_data</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">colnames_nested_data</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grid_id"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df_double_arranged</span> <span class="op">&lt;-</span> <span class="va">df_enriched</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># take the first 20 users for example</span></span>
<span>  <span class="fu"><a href="../reference/arrange_double_nested.html">arrange_double_nested</a></span><span class="op">(</span><span class="va">.</span>, nest_cols <span class="op">=</span> <span class="va">colnmaes_to_nest</span>, </span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span><span class="op">)</span> <span class="co"># sort by time in descending order</span></span>
<span><span class="co">#&gt; 🛠 Start sorting...</span></span>
<span><span class="co">#&gt; ✅ Finish sorting!</span></span>
<span><span class="co">#&gt; ⌛ Sorting time: 2.544 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span></span>
<span><span class="co"># original third user</span></span>
<span><span class="va">df_enriched</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data              </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 11<span style="text-decoration: underline;">616</span>678 <span style="color: #949494;">&lt;tibble [938 × 8]&gt;</span></span></span>
<span><span class="co"># third user data points </span></span>
<span><span class="va">df_enriched</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 938 × 8</span></span></span>
<span><span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2014-07-18 <span style="color: #949494;">10:08:21</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>014     7    18     6    10 2014-07-18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2013-11-24 <span style="color: #949494;">23:16:24</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013    11    24     1    23 2013-11-24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2013-06-12 <span style="color: #949494;">00:59:42</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    12     4     0 2013-06-12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2013-06-07 <span style="color: #949494;">19:56:56</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     7     6    19 2013-06-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2013-06-12 <span style="color: #949494;">01:08:29</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    12     4     1 2013-06-12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2013-06-02 <span style="color: #949494;">20:53:09</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     2     1    20 2013-06-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2013-06-10 <span style="color: #949494;">20:57:17</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    10     2    20 2013-06-10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2013-06-04 <span style="color: #949494;">17:42:06</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6     4     3    17 2013-06-04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2014-07-10 <span style="color: #949494;">01:00:45</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>014     7    10     5     1 2014-07-10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2013-06-13 <span style="color: #949494;">01:48:27</span>    <span style="text-decoration: underline;">1</span>375  <span style="text-decoration: underline;">2</span>013     6    13     5     1 2013-06-13</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 928 more rows</span></span></span>
<span><span class="co"># arranged third user</span></span>
<span><span class="va">df_double_arranged</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;       u_id data             </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 11<span style="text-decoration: underline;">616</span>678 <span style="color: #949494;">&lt;tibble [61 × 2]&gt;</span></span></span>
<span><span class="co"># arranged time </span></span>
<span><span class="va">df_double_arranged</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   created_at           year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2013-06-07 <span style="color: #949494;">09:44:12</span>  <span style="text-decoration: underline;">2</span>013     6     7     6     9 2013-06-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2013-06-04 <span style="color: #949494;">09:42:57</span>  <span style="text-decoration: underline;">2</span>013     6     4     3     9 2013-06-04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2013-06-02 <span style="color: #949494;">13:40:22</span>  <span style="text-decoration: underline;">2</span>013     6     2     1    13 2013-06-02</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="top-n">Top N<a class="anchor" aria-label="anchor" href="#top-n"></a>
</h4>
<p>The <code><a href="../reference/top_n_nested.html">top_n_nested()</a></code> function works in the same way as <a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a>
function in <a href="https://github.com/tidyverse/tidyverse" class="external-link">tidyverse</a> but for
nested dataframe. It allows to select the top entries in each group,
ordered by wt.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_enriched</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,170 × 8</span></span></span>
<span><span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2014-10-03 <span style="color: #949494;">16:29:48</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014    10     3     6    16 2014-10-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2014-01-29 <span style="color: #949494;">23:29:27</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     1    29     4    23 2014-01-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2014-12-07 <span style="color: #949494;">04:54:01</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014    12     7     1     4 2014-12-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2014-09-24 <span style="color: #949494;">00:27:25</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     9    24     4     0 2014-09-24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2014-05-05 <span style="color: #949494;">09:19:41</span>    <span style="text-decoration: underline;">1</span>239  <span style="text-decoration: underline;">2</span>014     5     5     2     9 2014-05-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2014-12-17 <span style="color: #949494;">16:36:28</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014    12    17     4    16 2014-12-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2014-01-29 <span style="color: #949494;">23:00:14</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     1    29     4    23 2014-01-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2014-12-15 <span style="color: #949494;">07:47:08</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014    12    15     2     7 2014-12-15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2014-09-28 <span style="color: #949494;">01:28:52</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     9    28     1     1 2014-09-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2015-01-20 <span style="color: #949494;">16:24:24</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>015     1    20     3    16 2015-01-20</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,160 more rows</span></span></span>
<span></span>
<span><span class="co">## get the top 1 row based on hour </span></span>
<span><span class="va">df_top_1</span> <span class="op">&lt;-</span> <span class="va">df_enriched</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/top_n_nested.html">top_n_nested</a></span><span class="op">(</span><span class="va">.</span>, n <span class="op">=</span> <span class="fl">1</span>, wt <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 🛠 Start selecting top 1 row(s)...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✅ Finish selecting top 1 row(s)!</span></span>
<span><span class="co">#&gt; ⌛ Selecting time: 0.286 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">df_top_1</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 46 × 8</span></span></span>
<span><span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2014-01-29 <span style="color: #949494;">23:29:27</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     1    29     4    23 2014-01-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2014-01-29 <span style="color: #949494;">23:00:14</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     1    29     4    23 2014-01-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2014-05-07 <span style="color: #949494;">23:15:11</span>    <span style="text-decoration: underline;">1</span>460  <span style="text-decoration: underline;">2</span>014     5     7     4    23 2014-05-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2014-06-20 <span style="color: #949494;">23:00:19</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     6    20     6    23 2014-06-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2014-05-07 <span style="color: #949494;">23:05:08</span>    <span style="text-decoration: underline;">1</span>425  <span style="text-decoration: underline;">2</span>014     5     7     4    23 2014-05-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2014-08-15 <span style="color: #949494;">23:40:17</span>    <span style="text-decoration: underline;">1</span>460  <span style="text-decoration: underline;">2</span>014     8    15     6    23 2014-08-15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2014-04-28 <span style="color: #949494;">23:27:11</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014     4    28     2    23 2014-04-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2015-03-06 <span style="color: #949494;">23:04:42</span>    <span style="text-decoration: underline;">1</span>471  <span style="text-decoration: underline;">2</span>015     3     6     6    23 2015-03-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2014-12-21 <span style="color: #949494;">23:01:58</span>    <span style="text-decoration: underline;">1</span>461  <span style="text-decoration: underline;">2</span>014    12    21     1    23 2014-12-21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2014-05-07 <span style="color: #949494;">23:23:21</span>    <span style="text-decoration: underline;">1</span>460  <span style="text-decoration: underline;">2</span>014     5     7     4    23 2014-05-07</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 36 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="identify-locations-with-embedded-recipes">Identify location(s) with embedded recipes<a class="anchor" aria-label="anchor" href="#identify-locations-with-embedded-recipes"></a>
</h4>
<p>To use the embedded recipes to identify the home location for users,
you can use <code><a href="../reference/identify_location.html">identify_location()</a></code> function.</p>
<ul>
<li>
<code>df</code>: a dataframe with columns for the user id, location,
timestamp</li>
<li>
<code>user</code>: name of column that holds unique identifier for
each user</li>
<li>
<code>timestamp</code>: name of timestamp column. Should be
POSIXct</li>
<li>
<code>location</code>: name of column that holds unique identifier
for each location</li>
<li>
<code>recipe</code>: embedded algorithms to identify the most
possible home locations for users<br>
</li>
<li>
<code>show_n_loc</code>: number of potential homes to extract</li>
<li>
<code>keep_score</code>: option to keep or remove calculated
result/score per user per location</li>
</ul>
<p>Current available recipes:</p>
<ul>
<li>
<code>recipe_HMLC</code>:
<ul>
<li>Weighs data points across multiple time frames to ‘score’
potentially meaningful locations for each user</li>
</ul>
</li>
<li>
<code>recipe_FREQ</code>
<ul>
<li>Selects the most frequently ‘visited’ location assuming a user is
active mainly around their home location.</li>
</ul>
</li>
<li>
<code>recipe_OSNA</code>: <a href="https://doi.org/10.1145/2808797.2808877" class="external-link">Efstathiades et
al.2015</a>
<ul>
<li>Finds the most ‘popular’ location during ‘rest’, ‘active’ and
‘leisure time. Here we focus on ’rest’ and ‘leisure’ time to find the
most possible home location for each user.</li>
</ul>
</li>
<li>
<code>recipe_APDM</code>: <a href="https://doi.org/10.1080/10630731003597306" class="external-link">Ahas et al. 2010</a>
<ul>
<li>Calculates the average and standard deviation of start time data
points by a single user, in a single location.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># recipe: homelocator -- HMLC</span></span>
<span><span class="fu"><a href="../reference/identify_location.html">identify_location</a></span><span class="op">(</span><span class="va">test_sample</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, timestamp <span class="op">=</span> <span class="st">"created_at"</span>, </span>
<span>                  location <span class="op">=</span> <span class="st">"grid_id"</span>, show_n_loc <span class="op">=</span> <span class="fl">1</span>, recipe <span class="op">=</span> <span class="st">"HMLC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># recipe: Frequency -- FREQ</span></span>
<span><span class="fu"><a href="../reference/identify_location.html">identify_location</a></span><span class="op">(</span><span class="va">test_sample</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, timestamp <span class="op">=</span> <span class="st">"created_at"</span>, </span>
<span>                  location <span class="op">=</span> <span class="st">"grid_id"</span>, show_n_loc <span class="op">=</span> <span class="fl">1</span>, recipe <span class="op">=</span> <span class="st">"FREQ"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># recipe: Online Social Network Activity -- OSNA</span></span>
<span><span class="fu"><a href="../reference/identify_location.html">identify_location</a></span><span class="op">(</span><span class="va">test_sample</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, timestamp <span class="op">=</span> <span class="st">"created_at"</span>, </span>
<span>                  location <span class="op">=</span> <span class="st">"grid_id"</span>, show_n_loc <span class="op">=</span> <span class="fl">1</span>, recipe <span class="op">=</span> <span class="st">"OSNA"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># recipe: Online Social Network Activity -- APDM</span></span>
<span><span class="co">## APDM recipe strictly returns the most likely home location</span></span>
<span><span class="co">## It is important to load the neighbors table before you use the recipe!!</span></span>
<span><span class="co">## example: st_queen &lt;- function(a, b = a) st_relate(a, b, pattern = "F***T****")</span></span>
<span><span class="co">##          neighbors &lt;- st_queen(df_sf) ===&gt; convert result to dataframe </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"df_neighbors"</span>, package <span class="op">=</span> <span class="st">"homelocator"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/identify_location.html">identify_location</a></span><span class="op">(</span><span class="va">test_sample</span>, user <span class="op">=</span> <span class="st">"u_id"</span>, timestamp <span class="op">=</span> <span class="st">"created_at"</span>, </span>
<span>                  location <span class="op">=</span> <span class="st">"grid_id"</span>, recipe <span class="op">=</span> <span class="st">"APDM"</span>, keep_score <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Qingqing Chen, Ate Poorthuis.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
