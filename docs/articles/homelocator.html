<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>homelocator • homelocator</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="homelocator">
<meta property="og:description" content="homelocator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">homelocator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/homelocator.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/spatialnetworkslab/homelocator/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="homelocator_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>homelocator</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/spatialnetworkslab/homelocator/blob/master/vignettes/homelocator.Rmd"><code>vignettes/homelocator.Rmd</code></a></small>
      <div class="hidden name"><code>homelocator.Rmd</code></div>

    </div>

    
    
<pre><code>#&gt; Loading homelocator
#&gt; Welcome to homelocator package!</code></pre>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">homelocator</span>)</pre></body></html></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p align="justify">
Identifying meaningful locations, such as home and/or work locations from mobile technology is an essential step in the field of mobility analysis. The <code>homelocator</code> library is designed for identifying meaningful locations of user based on the spatio-temporally features contained within the mobility data, such as social media data, mobile phone data, mobile app data and so on.
</p>
<p align="justify">
Although there is a myriad of different approaches to inferring meaningful locaitons in the last 10 years, a consensus or single best approach has not emerged in the current state-of-the-art. The actual algorithms used are not always discussed in detail in publications and the source codes are seldom released in public, which makes comparing algorithms as well as reproducing work difficult.
</p>
<p align="justify">
So, the main objective for developing this package is to provide a consistent framework and interface for the adoption of different approaches so that researchers are able to write structured, algorithmic ‘recipes’, or use the existing embeded “recipes” to identify meaningful locations according to their research requirements. With this package, users are able to achieve an apples-to-apples comparison across approaches.
</p>
<p align="justify">
We hope that through packages like <code>homelocator</code>, future work that relies on the inference of meaningful locations becomes less ‘custom’ (with each researcher writing their own algorithm) but instead will use common, comparable algorithms in order to increase transparency and reproducibility in the field.
</p>
</div>
<div id="test-data" class="section level1">
<h1 class="hasAnchor">
<a href="#test-data" class="anchor"></a>Test Data</h1>
<p>To explore the basic data manipulation functions of <code>homelocator</code>, we’ll use a <code>test_sample</code> dataset.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># load data</span>
<span class="no">test_sample</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu">here</span>(<span class="st">"data/test_sample.rds"</span>))

<span class="co"># show test sample </span>
<span class="no">test_sample</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   u_id     created_at          grid_id</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dttm&gt;                &lt;int&gt;</span>
<span class="co">#&gt; 1 26295661 2013-03-05 22:03:15     566</span>
<span class="co">#&gt; 2 69400017 2013-06-11 14:12:45    1012</span>
<span class="co">#&gt; 3 16294855 2013-04-30 18:47:58    1188</span></pre></body></html></div>
<p><span style="color:red"><em>Note:</em></span> <em>if you use your own dataset, please make sure that you have converted the timestamps to the appropriate local time zone.</em></p>
</div>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<div id="functions" class="section level2">
<h2 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h2>
<div id="validate-input-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#validate-input-dataset" class="anchor"></a>Validate input dataset</h3>
<p>The <code><a href="../reference/validate_dataset.html">validate_dataset()</a></code> function in <code>validate_datset.R</code> script makes sure your input dataset contains all three necessary variables: user, location and timestamp. There are 4 arguments in this function:</p>
<ul>
<li>
<code>user</code>: name of column that holds a unique identifier for each user.</li>
<li>
<code>timestamp</code>: name of column that holds specific timestamp for each data point. This timestamp should be in <code>POSIXct</code> format.</li>
<li>
<code>location</code>: name of column that holds a unique identifier for each location.</li>
<li>
<code>keep_other_vars</code>: option to keep or remove any other variables of the input dataset. The default is <code>FALSE</code>.</li>
</ul>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">df_validated</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/validate_dataset.html">validate_dataset</a></span>(<span class="no">test_sample</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">timestamp</span> <span class="kw">=</span> <span class="st">"created_at"</span>,
                                 <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">keep_other_vars</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; 🎉 Congratulations!! Your dataset has passed validation.</span>
<span class="co">#&gt; 👤 There are 3000 unique users in your dataset.</span>
<span class="co">#&gt; 🌏 Now start your journey identifying their meaningful location(s)!</span>
<span class="co">#&gt; 👏 Good luck!</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_validated</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   u_id     grid_id created_at         </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;int&gt; &lt;dttm&gt;             </span>
<span class="co">#&gt; 1 26295661     566 2013-03-05 22:03:15</span>
<span class="co">#&gt; 2 69400017    1012 2013-06-11 14:12:45</span>
<span class="co">#&gt; 3 16294855    1188 2013-04-30 18:47:58</span></pre></body></html></div>
</div>
<div id="nest-and-unnest" class="section level3">
<h3 class="hasAnchor">
<a href="#nest-and-unnest" class="anchor"></a>Nest and Unnest</h3>
<p>The <code><a href="../reference/nest_verbose.html">nest_verbose()</a></code> and <code><a href="../reference/unnest_verbose.html">unnest_verbose()</a></code> functions in <code>nest.R</code> script work in the same way as <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/nest">nest</a> and <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/unnest">unnest</a> functions in <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> but with some additional status information such as the elapsed running time.</p>
<ul>
<li>
<code>df</code>: a dataframe</li>
<li>
<code>...</code>: for <code><a href="../reference/nest_verbose.html">nest_verbose()</a></code> refers to selected columns to nest and for <code><a href="../reference/unnest_verbose.html">unnest_verbose()</a></code> refers to the list column to unnest.</li>
</ul>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># nest data</span>
<span class="no">df_nested</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nest_verbose.html">nest_verbose</a></span>(<span class="no">df_validated</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"created_at"</span>, <span class="st">"grid_id"</span>))
<span class="co">#&gt; 🛠 Start nesting...</span>
<span class="co">#&gt; ✅ Finish nesting!</span>
<span class="co">#&gt; ⌛ Nesting time: 0.48 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_nested</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   u_id     data                </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;              </span>
<span class="co">#&gt; 1 26295661 &lt;tibble [406 × 2]&gt;  </span>
<span class="co">#&gt; 2 69400017 &lt;tibble [79 × 2]&gt;   </span>
<span class="co">#&gt; 3 16294855 &lt;tibble [5,889 × 2]&gt;</span>

<span class="co"># show result </span>
<span class="no">df_nested</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   created_at          grid_id</span>
<span class="co">#&gt;   &lt;dttm&gt;                &lt;int&gt;</span>
<span class="co">#&gt; 1 2013-03-05 22:03:15     566</span>
<span class="co">#&gt; 2 2013-04-05 11:01:55     518</span>
<span class="co">#&gt; 3 2014-08-06 23:31:32     579</span>

<span class="co"># unnest data</span>
<span class="no">df_unnested</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/unnest_verbose.html">unnest_verbose</a></span>(<span class="no">df_nested</span>, <span class="no">data</span>)
<span class="co">#&gt; 🛠 Start unnesting...</span>
<span class="co">#&gt; ✅ Finish unnesting!</span>
<span class="co">#&gt; ⌛ Unnesting time: 0.053 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_unnested</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   u_id     created_at          grid_id</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dttm&gt;                &lt;int&gt;</span>
<span class="co">#&gt; 1 26295661 2013-03-05 22:03:15     566</span>
<span class="co">#&gt; 2 26295661 2013-04-05 11:01:55     518</span>
<span class="co">#&gt; 3 26295661 2014-08-06 23:31:32     579</span></pre></body></html></div>
</div>
<div id="double-nest-and-double-unnest" class="section level3">
<h3 class="hasAnchor">
<a href="#double-nest-and-double-unnest" class="anchor"></a>Double nest and Double unnest</h3>
<p>The <code>nest_double_nest()</code> and <code><a href="../reference/unnest_double_nested.html">unnest_double_nested()</a></code> functions in <code>nest.R</code> script work in the similar way as <code><a href="../reference/nest_verbose.html">nest_verbose()</a></code> and <code><a href="../reference/unnest_verbose.html">unnest_verbose()</a></code> functions but they apply to an already nested data frame. In another words, they map <code>nest</code> and <code>unnest</code> function to each element of a list created a double-nested data frame, or vice versa. This is an essential step in many home location algorithms as they often operate ‘per user, per location’.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>...</code>: for <code>nest_double_nest()</code> refers to selected columns to nest and for <code><a href="../reference/unnest_double_nested.html">unnest_double_nested()</a></code> refers to list-column to unnest.</li>
</ul>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># double nest data (e.g., nesting column: created_at)</span>
<span class="no">df_double_nested</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nest_nested.html">nest_nested</a></span>(<span class="no">df_nested</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">100</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"created_at"</span>))
<span class="co">#&gt; 🛠 Start nesting...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish nesting!</span>
<span class="co">#&gt; ⌛ Nesting time: 1.687 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_double_nested</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   u_id     data              </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;            </span>
<span class="co">#&gt; 1 26295661 &lt;tibble [43 × 2]&gt; </span>
<span class="co">#&gt; 2 69400017 &lt;tibble [28 × 2]&gt; </span>
<span class="co">#&gt; 3 16294855 &lt;tibble [372 × 2]&gt;</span>

<span class="co"># show result </span>
<span class="no">df_double_nested</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   grid_id data              </span>
<span class="co">#&gt;     &lt;int&gt; &lt;list&gt;            </span>
<span class="co">#&gt; 1     566 &lt;tibble [143 × 1]&gt;</span>
<span class="co">#&gt; 2     518 &lt;tibble [45 × 1]&gt; </span>
<span class="co">#&gt; 3     579 &lt;tibble [77 × 1]&gt;</span>

<span class="no">df_double_nested</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 1</span>
<span class="co">#&gt;   created_at         </span>
<span class="co">#&gt;   &lt;dttm&gt;             </span>
<span class="co">#&gt; 1 2013-03-05 22:03:15</span>
<span class="co">#&gt; 2 2013-05-02 15:57:32</span>
<span class="co">#&gt; 3 2013-03-20 04:06:35</span>

<span class="co"># unnest nested data </span>
<span class="no">df_double_unnested</span> <span class="kw">&lt;-</span> <span class="no">df_double_nested</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">100</span>) <span class="kw">%&gt;%</span>  <span class="co">## take first 100 rows for example</span>
  <span class="fu"><a href="../reference/unnest_double_nested.html">unnest_double_nested</a></span>(<span class="no">.</span>, <span class="no">data</span>)
<span class="co">#&gt; 🛠 Start unnesting...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish unnesting!</span>
<span class="co">#&gt; ⌛ Unnesting time: 0.587 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_double_unnested</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   u_id     grid_id created_at         </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;int&gt; &lt;dttm&gt;             </span>
<span class="co">#&gt; 1 26295661     566 2013-03-05 22:03:15</span>
<span class="co">#&gt; 2 26295661     566 2013-05-02 15:57:32</span>
<span class="co">#&gt; 3 26295661     566 2013-03-20 04:06:35</span></pre></body></html></div>
</div>
<div id="enrich-timestamp" class="section level3">
<h3 class="hasAnchor">
<a href="#enrich-timestamp" class="anchor"></a>Enrich timestamp</h3>
<p>The <code><a href="../reference/enrich_timestamp.html">enrich_timestamp()</a></code> in <code>enrich_timestamp.R</code> script creates additional variables that are derived from the timestamp column. These include the year, month, day, day of the week and hour of the day. These are often used/needed as intermediate variables in home location algorithms.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>timestamp</code>: name of column that holds the specific timestamp for each data point. This timestamp should be in <code>POSIXct</code> format.</li>
<li>
<code>tz</code>: a character string containing the time zone to convert to. This should be one of the time zones <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/timezones.html">recognized by R</a>. The default <code>tz</code> is set to <code>Asia/Singapore</code>.</li>
</ul>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">#original variables </span>
<span class="no">df_nested</span>[<span class="fl">1</span>, ] <span class="kw">%&gt;%</span> <span class="fu">unnest</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">data</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   u_id     created_at          grid_id</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dttm&gt;                &lt;int&gt;</span>
<span class="co">#&gt; 1 26295661 2013-03-05 22:03:15     566</span>
<span class="co">#&gt; 2 26295661 2013-04-05 11:01:55     518</span>
<span class="co">#&gt; 3 26295661 2014-08-06 23:31:32     579</span>

<span class="co"># create new variables from "created_at" timestamp column </span>
<span class="no">df_enriched</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/enrich_timestamp.html">enrich_timestamp</a></span>(<span class="no">df_nested</span>, <span class="kw">timestamp</span> <span class="kw">=</span> <span class="st">"created_at"</span>, <span class="kw">tz</span> <span class="kw">=</span> <span class="st">"Asia/Singapore"</span>)
<span class="co">#&gt; 🛠 Enriching variables from timestamp...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish enriching! New added variables: year, month, day, wday, hour, ymd.</span>
<span class="co">#&gt; ⌛ Enriching time: 2.65 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_enriched</span>[<span class="fl">1</span>, ] <span class="kw">%&gt;%</span> <span class="fu">unnest</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">data</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 9</span>
<span class="co">#&gt;   u_id     created_at          grid_id  year month   day  wday  hour ymd       </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dttm&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt; 1 26295661 2013-03-05 22:03:15     566  2013     3     5     3    22 2013-03-05</span>
<span class="co">#&gt; 2 26295661 2013-04-05 11:01:55     518  2013     4     5     6    11 2013-04-05</span>
<span class="co">#&gt; 3 26295661 2014-08-06 23:31:32     579  2014     8     6     4    23 2014-08-06</span></pre></body></html></div>
</div>
<div id="summarize-in-nested-and-double-nested-dataframe" class="section level3">
<h3 class="hasAnchor">
<a href="#summarize-in-nested-and-double-nested-dataframe" class="anchor"></a>Summarize in nested and double nested dataframe</h3>
<p>The <code><a href="../reference/summarise_nested.html">summarise_nested()</a></code> function in the <code>summarise.R</code> script works similar to dplyr’s regular <code>summarise</code> function but operates within a nested tibble. <code><a href="../reference/summarise_double_nested.html">summarise_double_nested()</a></code> conversely operates within a double-nested tibble.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>nest_cols</code>: a selection of columns to nest in existing list-column</li>
<li>
<code>...</code>: name-value pairs of summary functions</li>
</ul>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># summarize in nested dataframe </span>
<span class="co"># e.g., summarise total number of tweets and total number of places per user</span>
<span class="no">df_summarize_nested</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/summarise_nested.html">summarise_nested</a></span>(<span class="no">df_enriched</span>,
                                        <span class="kw">n_tweets</span> <span class="kw">=</span> <span class="fu">n</span>(),
                                        <span class="kw">n_locs</span> <span class="kw">=</span> <span class="fu">n_distinct</span>(<span class="no">grid_id</span>))
<span class="co">#&gt; 🛠 Start summarising values...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish summarising! There are 2 new added variables: n_tweets, n_locs</span>
<span class="co">#&gt; ⌛ Summarising time: 0.693 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_summarize_nested</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   u_id     data                 n_tweets n_locs</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;                  &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 26295661 &lt;tibble [406 × 8]&gt;        406     43</span>
<span class="co">#&gt; 2 69400017 &lt;tibble [79 × 8]&gt;          79     28</span>
<span class="co">#&gt; 3 16294855 &lt;tibble [5,889 × 8]&gt;     5889    372</span>

<span class="co"># summarize in double nested dataframe </span>
<span class="co"># take first 100 users for example</span>
<span class="co"># e.g summarise total number of tweets and totla number of distinct days </span>
<span class="no">df_summarize_double_nested</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/summarise_double_nested.html">summarise_double_nested</a></span>(<span class="no">df_enriched</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">100</span>),
                    <span class="kw">nest_cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"created_at"</span>, <span class="st">"ymd"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"wday"</span>, <span class="st">"hour"</span>),
                    <span class="kw">n_tweets</span> <span class="kw">=</span> <span class="fu">n</span>(), <span class="kw">n_days</span> <span class="kw">=</span> <span class="fu">n_distinct</span>(<span class="no">ymd</span>))
<span class="co">#&gt; 🛠 Start summarising values...</span>
<span class="co">#&gt; ✅ Finish summarising! There are 2 new added variables: n_tweets, n_days</span>
<span class="co">#&gt; ⌛ Summarising time: 1.72 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_summarize_double_nested</span>[<span class="fl">1</span>, ]
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   u_id     data             </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;           </span>
<span class="co">#&gt; 1 26295661 &lt;tibble [43 × 4]&gt;</span>
<span class="no">df_summarize_double_nested</span>[<span class="fl">1</span>, ]$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   grid_id data               n_tweets n_days</span>
<span class="co">#&gt;     &lt;int&gt; &lt;list&gt;                &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1     566 &lt;tibble [143 × 7]&gt;      143     50</span>
<span class="co">#&gt; 2     518 &lt;tibble [45 × 7]&gt;        45     32</span>
<span class="co">#&gt; 3     579 &lt;tibble [77 × 7]&gt;        77     55</span></pre></body></html></div>
</div>
<div id="remove-active-users" class="section level3">
<h3 class="hasAnchor">
<a href="#remove-active-users" class="anchor"></a>Remove active users</h3>
<p>The <code><a href="../reference/remove_top_users.html">remove_top_users()</a></code> function in <code>remove_top_users.R</code> script allows to remove top <code>N</code> percent of active users based on the total number of data points per user. Although the majority of users are real people, some accounts are run by algorithms or ‘bots’, whereas others can be considered as spam accounts. Removing a certain top <code>N</code> percent of active users is an oft-used approach to remove such accounts and reduce the number of such users in the final dataset.</p>
<ul>
<li>
<code>df</code>: a dataframe with columns of user id, and data point counts</li>
<li>
<code>user</code>: name of column that holds unique identifier for each user</li>
<li>
<code>counts</code>: name of column that holds the data points frequency for each user<br>
</li>
<li>
<code>topNpct_user</code>: a decimal number that represent the certain percentage of users to remove</li>
</ul>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># remove top 1% active users (e.g based on the frequency of tweets sent by users)</span>
<span class="no">df_removed_active_users</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/remove_top_users.html">remove_top_users</a></span>(<span class="no">df_summarize_nested</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>,
                                            <span class="kw">counts</span> <span class="kw">=</span> <span class="st">"n_tweets"</span>, <span class="kw">topNpct_user</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="co">#&gt; 👤 There are 3000 users at this moment.</span>
<span class="co">#&gt; 🛠 Start removing top 1% top active users...</span>
<span class="co">#&gt; ✅ Finish removing! Removed 29 active users!</span>
<span class="co">#&gt; 👤 There are 2971 users left.</span>
<span class="co">#&gt; ⌛ Removing time: 0.001 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_removed_active_users</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   u_id     data                 n_tweets n_locs</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;                  &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 67314149 &lt;tibble [2,366 × 8]&gt;     2366    184</span>
<span class="co">#&gt; 2 70005330 &lt;tibble [2,309 × 8]&gt;     2309    204</span>
<span class="co">#&gt; 3 74570766 &lt;tibble [2,240 × 8]&gt;     2240    167</span></pre></body></html></div>
</div>
<div id="filter" class="section level3">
<h3 class="hasAnchor">
<a href="#filter" class="anchor"></a>Filter</h3>
<p>The <code><a href="../reference/filter_verbose.html">filter_verbose()</a></code> function in <code>filter.R</code> script works in the same way as <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/filter">filter</a> function in <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> but with additional information about the number of (filtered) users remaining in the dataset. And the <code><a href="../reference/filter_nested.html">filter_nested()</a></code> function works in the similar way as <code><a href="../reference/filter_verbose.html">filter_verbose()</a></code> but is applied within a nested tibble.</p>
<ul>
<li>
<code>df</code>: a dataframe with columns of user id, and variables that your are going to apply the filter function. If the column not in the dataset, you need to add that column before you apply the filter</li>
<li>
<code>user</code>: name of column that holds unique identifier for each user</li>
<li>
<code>...</code>: Logical predicates defined in terms of the variables in df. Only rows match conditions are kept.</li>
</ul>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># filter users with less than 10 tweets sent at less than 10 places </span>
<span class="no">df_filtered</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/filter_verbose.html">filter_verbose</a></span>(<span class="no">df_removed_active_users</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>,
                              <span class="no">n_tweets</span> <span class="kw">&gt;</span> <span class="fl">10</span> <span class="kw">&amp;</span> <span class="no">n_locs</span> <span class="kw">&gt;</span> <span class="fl">10</span>)
<span class="co">#&gt; 👤 There are 2971 users at this moment.</span>
<span class="co">#&gt; 🛠 Start filtering users...</span>
<span class="co">#&gt; ✅ Finish filtering! Filterred 1008 users!</span>
<span class="co">#&gt; 👤 There are 1963 users left.</span>
<span class="co">#&gt; ⌛ Filtering time: 0.001 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_filtered</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   u_id     data                 n_tweets n_locs</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;                  &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 67314149 &lt;tibble [2,366 × 8]&gt;     2366    184</span>
<span class="co">#&gt; 2 70005330 &lt;tibble [2,309 × 8]&gt;     2309    204</span>
<span class="co">#&gt; 3 74570766 &lt;tibble [2,240 × 8]&gt;     2240    167</span>

<span class="co"># filter tweets that sent on weekends and during daytime (8am to 6pm)</span>
<span class="no">df_filter_nested</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/filter_nested.html">filter_nested</a></span>(<span class="no">df_filtered</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>,
                                  !<span class="no">wday</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">7</span>), <span class="co"># 1 means Sunday and 7 means Saturday</span>
                                  !<span class="no">hour</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">8</span>, <span class="fl">18</span>, <span class="fl">1</span>))
<span class="co">#&gt; 👤 There are 1963 users at this moment.</span>
<span class="co">#&gt; 🛠 Start filtering user...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish Filtering! Filterred 17 users!</span>
<span class="co">#&gt; 👤 There are 1946 users left!</span>
<span class="co">#&gt; ⌛ Filtering time: 0.934 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_filter_nested</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   u_id     data               n_tweets n_locs</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;                &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 67314149 &lt;tibble [392 × 8]&gt;     2366    184</span>
<span class="co">#&gt; 2 70005330 &lt;tibble [258 × 8]&gt;     2309    204</span>
<span class="co">#&gt; 3 74570766 &lt;tibble [467 × 8]&gt;     2240    167</span>

<span class="no">df_filter_nested</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 8</span>
<span class="co">#&gt;   created_at          grid_id  year month   day  wday  hour ymd       </span>
<span class="co">#&gt;   &lt;dttm&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt; 1 2015-12-21 05:57:22     670  2015    12    21     2     5 2015-12-21</span>
<span class="co">#&gt; 2 2015-10-30 21:30:41     480  2015    10    30     6    21 2015-10-30</span>
<span class="co">#&gt; 3 2014-10-09 02:54:46    1821  2014    10     9     5     2 2014-10-09</span></pre></body></html></div>
</div>
<div id="mutate" class="section level3">
<h3 class="hasAnchor">
<a href="#mutate" class="anchor"></a>Mutate</h3>
<p>The <code><a href="../reference/mutate_verbose.html">mutate_verbose()</a></code> function in <code>filter.R</code> script works in the same way as <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.5.0/topics/mutate">mutate</a> function in <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> but with additional information about the elapsed running time.</p>
<ul>
<li>
<code>df</code>: a dataframe</li>
<li>
<code>...</code>: name-value pairs of expressions</li>
</ul>
<p>Function <code><a href="../reference/mutate_nested.html">mutate_nested()</a></code> works in the similar way as <code><a href="../reference/mutate_verbose.html">mutate_verbose()</a></code> but it adds new variables inside a nested tibble.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>...</code>: name-value pairs of expressions</li>
</ul>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co">## let's use pre-discussed functions to filter some users first </span>
<span class="no">colnmaes_data</span> <span class="kw">&lt;-</span> <span class="no">df_filtered</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>()
<span class="no">colnmaes_to_nest</span> <span class="kw">&lt;-</span> <span class="no">colnmaes_data</span>[-<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">colnmaes_data</span> <span class="kw">==</span> <span class="st">"grid_id"</span>)]

<span class="no">df_cleaned</span> <span class="kw">&lt;-</span> <span class="no">df_filtered</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/summarise_double_nested.html">summarise_double_nested</a></span>(<span class="no">.</span>, <span class="kw">nest_cols</span> <span class="kw">=</span> <span class="no">colnmaes_to_nest</span>,
                          <span class="kw">n_tweets_loc</span> <span class="kw">=</span> <span class="fu">n</span>(), <span class="co"># number of tweets sent at each location</span>
                          <span class="kw">n_hrs_loc</span> <span class="kw">=</span> <span class="fu">n_distinct</span>(<span class="no">hour</span>), <span class="co"># number of unique hours of sent tweets </span>
                          <span class="kw">n_days_loc</span> <span class="kw">=</span> <span class="fu">n_distinct</span>(<span class="no">ymd</span>), <span class="co"># number of unique days of sent tweets </span>
                          <span class="kw">period_loc</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">created_at</span>) - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">created_at</span>), <span class="st">"days"</span>)) <span class="kw">%&gt;%</span> <span class="co"># period of tweeting </span>
  <span class="fu"><a href="../reference/unnest_verbose.html">unnest_verbose</a></span>(<span class="no">data</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/filter_verbose.html">filter_verbose</a></span>(<span class="no">.</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>,
                 <span class="no">n_tweets_loc</span> <span class="kw">&gt;</span> <span class="fl">10</span> <span class="kw">&amp;</span> <span class="no">n_hrs_loc</span> <span class="kw">&gt;</span> <span class="fl">10</span> <span class="kw">&amp;</span> <span class="no">n_days_loc</span> <span class="kw">&gt;</span> <span class="fl">10</span> <span class="kw">&amp;</span> <span class="no">period_loc</span> <span class="kw">&gt;</span> <span class="fl">10</span>)
<span class="co">#&gt; 🛠 Start summarising values...</span>
<span class="co">#&gt; ✅ Finish summarising! There are 4 new added variables: n_tweets_loc, n_hrs_loc, n_days_loc, period_loc</span>
<span class="co">#&gt; ⌛ Summarising time: 35.388 secs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 🛠 Start unnesting...</span>
<span class="co">#&gt; ✅ Finish unnesting!</span>
<span class="co">#&gt; ⌛ Unnesting time: 0.037 secs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 👤 There are 1963 users at this moment.</span>
<span class="co">#&gt; 🛠 Start filtering users...</span>
<span class="co">#&gt; ✅ Finish filtering! Filterred 1118 users!</span>
<span class="co">#&gt; 👤 There are 845 users left.</span>
<span class="co">#&gt; ⌛ Filtering time: 0.004 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show cleaned dataset </span>
<span class="no">df_cleaned</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 9</span>
<span class="co">#&gt;   u_id  n_tweets n_locs grid_id data  n_tweets_loc n_hrs_loc n_days_loc</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;lis&gt;        &lt;int&gt;     &lt;int&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 6731…     2366    184     323 &lt;tib…          894        24         68</span>
<span class="co">#&gt; 2 6731…     2366    184    1821 &lt;tib…          734        24         69</span>
<span class="co">#&gt; 3 6731…     2366    184    1777 &lt;tib…           62        12         38</span>
<span class="co">#&gt; # … with 1 more variable: period_loc &lt;dbl&gt;</span>

<span class="co"># ok, then let's apply the mutate_nested function to add four new variables: wd_or_wk, time_numeric, rest_or_work, wk.am_or_wk.pm</span>
<span class="no">df_expanded</span> <span class="kw">&lt;-</span> <span class="no">df_cleaned</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/mutate_nested.html">mutate_nested</a></span>(<span class="kw">wd_or_wk</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="no">wday</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">7</span>), <span class="st">"weekend"</span>, <span class="st">"weekday"</span>),
                <span class="kw">time_numeric</span> <span class="kw">=</span> <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/hour.html">hour</a></span>(<span class="no">created_at</span>) + <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/minute.html">minute</a></span>(<span class="no">created_at</span>) / <span class="fl">60</span> + <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/second.html">second</a></span>(<span class="no">created_at</span>) / <span class="fl">3600</span>,
                <span class="kw">rest_or_work</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="no">time_numeric</span> <span class="kw">&gt;=</span> <span class="fl">9</span> <span class="kw">&amp;</span> <span class="no">time_numeric</span> <span class="kw">&lt;=</span> <span class="fl">18</span>, <span class="st">"work"</span>, <span class="st">"rest"</span>),
                <span class="kw">wk.am_or_wk.pm</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="no">time_numeric</span> <span class="kw">&gt;=</span> <span class="fl">6</span> <span class="kw">&amp;</span> <span class="no">time_numeric</span> <span class="kw">&lt;=</span> <span class="fl">12</span> <span class="kw">&amp;</span> <span class="no">wd_or_wk</span> <span class="kw">==</span> <span class="st">"weekend"</span>, <span class="st">"weekend_am"</span>, <span class="st">"weekend_pm"</span>))
<span class="co">#&gt; 🛠 Start adding variable(s)...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish adding! There are 4 new added variables: wd_or_wk, time_numeric, rest_or_work, wk.am_or_wk.pm</span>
<span class="co">#&gt; ⌛ Adding time: 1.349 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_expanded</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 9</span>
<span class="co">#&gt;   u_id  n_tweets n_locs grid_id data  n_tweets_loc n_hrs_loc n_days_loc</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;lis&gt;        &lt;int&gt;     &lt;int&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 6731…     2366    184     323 &lt;tib…          894        24         68</span>
<span class="co">#&gt; 2 6731…     2366    184    1821 &lt;tib…          734        24         69</span>
<span class="co">#&gt; 3 6731…     2366    184    1777 &lt;tib…           62        12         38</span>
<span class="co">#&gt; # … with 1 more variable: period_loc &lt;dbl&gt;</span></pre></body></html></div>
<p>The function <code><a href="../reference/prop_factor_nested.html">prop_factor_nested()</a></code> allows you to calculate the proportion of categories for a variable inside the list-column and convert each categories to a new variable adding to the dataframe. For example, inside the list-column, the variable <code>wd_or_wk</code> has two categories named weekend or weekday, when you call <code><a href="../reference/prop_factor_nested.html">prop_factor_nested()</a></code> function, it calculates the proportion of weekend and weekday separately, and the results are then expanded to two new columns called <code>weekday</code> and <code>weekend</code> adding to the dataframe.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>var</code>: name of column to calculate inside the list-column</li>
</ul>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># categories for a variable inside the list-column: e.g weekend or weekday</span>
<span class="no">df_expanded</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 11</span>
<span class="co">#&gt;   created_at           year month   day  wday  hour ymd        wd_or_wk</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;     &lt;chr&gt;   </span>
<span class="co">#&gt; 1 2014-11-01 04:59:20  2014    11     1     7     4 2014-11-01 weekend </span>
<span class="co">#&gt; 2 2014-06-20 17:02:21  2014     6    20     6    17 2014-06-20 weekday </span>
<span class="co">#&gt; 3 2014-11-02 15:19:30  2014    11     2     1    15 2014-11-02 weekend </span>
<span class="co">#&gt; # … with 3 more variables: time_numeric &lt;dbl&gt;, rest_or_work &lt;chr&gt;,</span>
<span class="co">#&gt; #   wk.am_or_wk.pm &lt;chr&gt;</span>

<span class="co"># calculate proportion of categories for four variables: wd_or_wk, rest_or_work, wk.am_or_wk.pm</span>
<span class="no">df_expanded</span> <span class="kw">&lt;-</span> <span class="no">df_expanded</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/prop_factor_nested.html">prop_factor_nested</a></span>(<span class="no">wd_or_wk</span>, <span class="no">rest_or_work</span>, <span class="no">wk.am_or_wk.pm</span>)
<span class="co">#&gt; 🛠 Start calculating proportion...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish calculating! There are 6 new calculated variables: rest, weekday, weekend, weekend_am, weekend_pm, work</span>
<span class="co">#&gt; ⌛ Calculating time: 25.551 secs</span>
<span class="co">#&gt; </span>

<span class="co"># show result </span>
<span class="no">df_expanded</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 15</span>
<span class="co">#&gt;   u_id  n_tweets n_locs grid_id data  n_tweets_loc n_hrs_loc n_days_loc</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;lis&gt;        &lt;int&gt;     &lt;int&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 6731…     2366    184     323 &lt;tib…          894        24         68</span>
<span class="co">#&gt; 2 6731…     2366    184    1821 &lt;tib…          734        24         69</span>
<span class="co">#&gt; 3 6731…     2366    184    1777 &lt;tib…           62        12         38</span>
<span class="co">#&gt; # … with 7 more variables: period_loc &lt;dbl&gt;, rest &lt;dbl&gt;, weekday &lt;dbl&gt;,</span>
<span class="co">#&gt; #   weekend &lt;dbl&gt;, weekend_am &lt;dbl&gt;, weekend_pm &lt;dbl&gt;, work &lt;dbl&gt;</span></pre></body></html></div>
</div>
<div id="score" class="section level3">
<h3 class="hasAnchor">
<a href="#score" class="anchor"></a>Score</h3>
<p>The <code><a href="../reference/score_nested.html">score_nested()</a></code> function in <code>score.R</code> script allows you to give a weighted value for one or more variables in a nested dataframe.</p>
<ul>
<li>
<code>df</code>: a nested dataframe by user</li>
<li>
<code>user</code>: name of column that holds unique identifier for each user</li>
<li>
<code>location</code>: name of column that holds unique identifier for each location</li>
<li>
<code>keep_ori_vars</code>: option to keep or drop original varialbes</li>
<li>
<code>...</code>: name-value pairs of expression</li>
</ul>
<p>The <code><a href="../reference/score_summary.html">score_summary()</a></code> function summarises all scored columns and return one single summary score per row.</p>
<ul>
<li>
<code>df</code>: a dataframe</li>
<li>
<code>user</code>: name of column that holds unique identifier for each user</li>
<li>
<code>location</code>: name of column that holds unique identifier for each location</li>
<li>
<code>...</code>: name of scored columns</li>
</ul>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co">## let's add two more variables before we do the scoring </span>
<span class="no">df_expanded</span> <span class="kw">&lt;-</span> <span class="no">df_expanded</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/summarise_nested.html">summarise_nested</a></span>(<span class="kw">n_wdays_loc</span> <span class="kw">=</span> <span class="fu">n_distinct</span>(<span class="no">wday</span>),
                   <span class="kw">n_months_loc</span> <span class="kw">=</span> <span class="fu">n_distinct</span>(<span class="no">month</span>))
<span class="co">#&gt; 🛠 Start summarising values...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish summarising! There are 2 new added variables: n_wdays_loc, n_months_loc</span>
<span class="co">#&gt; ⌛ Summarising time: 0.443 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_expanded</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 17</span>
<span class="co">#&gt;   u_id  n_tweets n_locs grid_id data  n_tweets_loc n_hrs_loc n_days_loc</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;lis&gt;        &lt;int&gt;     &lt;int&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 6731…     2366    184     323 &lt;tib…          894        24         68</span>
<span class="co">#&gt; 2 6731…     2366    184    1821 &lt;tib…          734        24         69</span>
<span class="co">#&gt; 3 6731…     2366    184    1777 &lt;tib…           62        12         38</span>
<span class="co">#&gt; # … with 9 more variables: period_loc &lt;dbl&gt;, rest &lt;dbl&gt;, weekday &lt;dbl&gt;,</span>
<span class="co">#&gt; #   weekend &lt;dbl&gt;, weekend_am &lt;dbl&gt;, weekend_pm &lt;dbl&gt;, work &lt;dbl&gt;,</span>
<span class="co">#&gt; #   n_wdays_loc &lt;int&gt;, n_months_loc &lt;int&gt;</span>

<span class="co"># when calculating scores, you can give weight to different variables, but the total weight should add up to 1</span>
<span class="no">df_scored</span> <span class="kw">&lt;-</span> <span class="no">df_expanded</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/score_nested.html">score_nested</a></span>(<span class="no">.</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">keep_original_vars</span> <span class="kw">=</span> <span class="no">F</span>,
               <span class="kw">s_n_tweets_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_tweets_loc</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">n_tweets_loc</span>)),
               <span class="kw">s_n_hrs_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_hrs_loc</span>/<span class="fl">24</span>),
               <span class="kw">s_n_days_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_days_loc</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">n_days_loc</span>)),
               <span class="kw">s_period_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">period_loc</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">period_loc</span>)),
               <span class="kw">s_n_wdays_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_wdays_loc</span>/<span class="fl">7</span>),
               <span class="kw">s_n_months_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_months_loc</span>/<span class="fl">12</span>),
               <span class="kw">s_weekend</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">weekend</span>),
               <span class="kw">s_rest</span> <span class="kw">=</span> <span class="fl">0.2</span> * (<span class="no">rest</span>),
               <span class="kw">s_wk_am</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">weekend_am</span>))
<span class="co">#&gt; 🛠 Start scoring ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish scoring! There are 9 new added variables: s_n_tweets_loc, s_n_hrs_loc, s_n_days_loc, s_period_loc, s_n_wdays_loc, s_n_months_loc, s_weekend, s_rest, s_wk_am</span>
<span class="co">#&gt; ⌛ Scoring time: 2.968 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_scored</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   u_id     data             </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;           </span>
<span class="co">#&gt; 1 67314149 &lt;tibble [3 × 10]&gt;</span>
<span class="co">#&gt; 2 70005330 &lt;tibble [6 × 10]&gt;</span>
<span class="co">#&gt; 3 74570766 &lt;tibble [6 × 10]&gt;</span>
<span class="no">df_scored</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]]
<span class="co">#&gt; # A tibble: 3 x 10</span>
<span class="co">#&gt;   grid_id s_n_tweets_loc s_n_hrs_loc s_n_days_loc s_period_loc s_n_wdays_loc</span>
<span class="co">#&gt;     &lt;int&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1     323        0.1            0.1        0.0986       0.0999           0.1</span>
<span class="co">#&gt; 2    1821        0.0821         0.1        0.1          0.0944           0.1</span>
<span class="co">#&gt; 3    1777        0.00694        0.05       0.0551       0.1              0.1</span>
<span class="co">#&gt; # … with 4 more variables: s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;,</span>
<span class="co">#&gt; #   s_wk_am &lt;dbl&gt;</span>

<span class="co">### we can replace the score function by mutate function </span>
<span class="no">df_scored_2</span> <span class="kw">&lt;-</span> <span class="no">df_expanded</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/nest_verbose.html">nest_verbose</a></span>(-<span class="no">u_id</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/mutate_nested.html">mutate_nested</a></span>(<span class="kw">s_n_tweets_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_tweets_loc</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">n_tweets_loc</span>)),
                <span class="kw">s_n_hrs_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_hrs_loc</span>/<span class="fl">24</span>),
                <span class="kw">s_n_days_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_days_loc</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">n_days_loc</span>)),
                <span class="kw">s_period_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">period_loc</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">period_loc</span>)),
                <span class="kw">s_n_wdays_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_wdays_loc</span>/<span class="fl">7</span>),
                <span class="kw">s_n_months_loc</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">n_months_loc</span>/<span class="fl">12</span>),
                <span class="kw">s_weekend</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">weekend</span>),
                <span class="kw">s_rest</span> <span class="kw">=</span> <span class="fl">0.2</span> * (<span class="no">rest</span>),
                <span class="kw">s_wk_am</span> <span class="kw">=</span> <span class="fl">0.1</span> * (<span class="no">weekend_am</span>))
<span class="co">#&gt; 🛠 Start nesting...</span>
<span class="co">#&gt; ✅ Finish nesting!</span>
<span class="co">#&gt; ⌛ Nesting time: 0.07 secs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 🛠 Start adding variable(s)...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish adding! There are 9 new added variables: s_n_tweets_loc, s_n_hrs_loc, s_n_days_loc, s_period_loc, s_n_wdays_loc, s_n_months_loc, s_weekend, s_rest, s_wk_am</span>
<span class="co">#&gt; ⌛ Adding time: 0.307 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_scored_2</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   u_id     data             </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;           </span>
<span class="co">#&gt; 1 67314149 &lt;tibble [3 × 25]&gt;</span>
<span class="co">#&gt; 2 70005330 &lt;tibble [6 × 25]&gt;</span>
<span class="co">#&gt; 3 74570766 &lt;tibble [6 × 25]&gt;</span>
<span class="no">df_scored_2</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]]
<span class="co">#&gt; # A tibble: 3 x 25</span>
<span class="co">#&gt;   n_tweets n_locs grid_id data  n_tweets_loc n_hrs_loc n_days_loc period_loc</span>
<span class="co">#&gt;      &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;lis&gt;        &lt;int&gt;     &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1     2366    184     323 &lt;tib…          894        24         68       807.</span>
<span class="co">#&gt; 2     2366    184    1821 &lt;tib…          734        24         69       763.</span>
<span class="co">#&gt; 3     2366    184    1777 &lt;tib…           62        12         38       808.</span>
<span class="co">#&gt; # … with 17 more variables: rest &lt;dbl&gt;, weekday &lt;dbl&gt;, weekend &lt;dbl&gt;,</span>
<span class="co">#&gt; #   weekend_am &lt;dbl&gt;, weekend_pm &lt;dbl&gt;, work &lt;dbl&gt;, n_wdays_loc &lt;int&gt;,</span>
<span class="co">#&gt; #   n_months_loc &lt;int&gt;, s_n_tweets_loc &lt;dbl&gt;, s_n_hrs_loc &lt;dbl&gt;,</span>
<span class="co">#&gt; #   s_n_days_loc &lt;dbl&gt;, s_period_loc &lt;dbl&gt;, s_n_wdays_loc &lt;dbl&gt;,</span>
<span class="co">#&gt; #   s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;, s_wk_am &lt;dbl&gt;</span></pre></body></html></div>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># sum varialbes score for each location </span>
<span class="no">df_score_summed</span> <span class="kw">&lt;-</span> <span class="no">df_scored</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/score_summary.html">score_summary</a></span>(<span class="no">.</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="fu">starts_with</span>(<span class="st">"s_"</span>))
<span class="co">#&gt; 🛠 Start summing scores...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish summing! There are 1 new added variables: score</span>
<span class="co">#&gt; ⌛ Summing time: 2.141 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_score_summed</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   u_id     data             </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;           </span>
<span class="co">#&gt; 1 67314149 &lt;tibble [3 × 11]&gt;</span>
<span class="co">#&gt; 2 70005330 &lt;tibble [6 × 11]&gt;</span>
<span class="co">#&gt; 3 74570766 &lt;tibble [6 × 11]&gt;</span>
<span class="no">df_score_summed</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]]
<span class="co">#&gt; # A tibble: 3 x 11</span>
<span class="co">#&gt;   grid_id s_n_tweets_loc s_n_hrs_loc s_n_days_loc s_period_loc s_n_wdays_loc</span>
<span class="co">#&gt;     &lt;int&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1     323        0.1            0.1        0.0986       0.0999           0.1</span>
<span class="co">#&gt; 2    1821        0.0821         0.1        0.1          0.0944           0.1</span>
<span class="co">#&gt; 3    1777        0.00694        0.05       0.0551       0.1              0.1</span>
<span class="co">#&gt; # … with 5 more variables: s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;,</span>
<span class="co">#&gt; #   s_wk_am &lt;dbl&gt;, score &lt;dbl&gt;</span></pre></body></html></div>
<p>== [NOTE FROM ATE: STILL NEED TO READ BELOW THIS LINE] == ### Extract locations</p>
<p>The <code><a href="../reference/extract_location.html">extract_location()</a></code> function in <code>extract_location.R</code> script allows you to sort the locations of each each user based on descending value of selected column, and return the top N location(s) for each user. The extracted locations thus be treated as the most possible home location of the user.</p>
<ul>
<li>
<code>df</code>: a nested dataframe by user</li>
<li>
<code>user</code>: name of column that holds unique identifier for each user</li>
<li>
<code>location</code>: name of column that holds unique identifier for each location</li>
<li>
<code>show_n_loc</code>: a single number that decides the number of locations to be extracted</li>
<li>
<code>keep_score</code>: option to keep or remove columns with scored value</li>
<li>
<code>...</code>: name of column(s) that used to sort the locations</li>
</ul>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># extract homes for users based on score value (each user return 1 most possible home)</span>
<span class="no">df_home</span> <span class="kw">&lt;-</span> <span class="no">df_score_summed</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/extract_location.html">extract_location</a></span>(<span class="no">.</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">show_n_loc</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">keep_score</span> <span class="kw">=</span> <span class="no">F</span>, <span class="no">score</span>)
<span class="co">#&gt; 🛠 Start extracting homes for users...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 🎉 Congratulations!! Your have found 845 users' potential home(s).</span>
<span class="co">#&gt; ⌛ Extracting time: 0.767 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_home</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   u_id     home </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;</span>
<span class="co">#&gt; 1 67314149 323  </span>
<span class="co">#&gt; 2 70005330 946  </span>
<span class="co">#&gt; 3 74570766 393</span>

<span class="co"># extract homes for users and keep scores of locations</span>
<span class="no">df_home</span> <span class="kw">&lt;-</span> <span class="no">df_score_summed</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/extract_location.html">extract_location</a></span>(<span class="no">.</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">show_n_loc</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">keep_score</span> <span class="kw">=</span> <span class="no">T</span>, <span class="no">score</span>)
<span class="co">#&gt; 🛠 Start extracting homes for users...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 🎉 Congratulations!! Your have found 845 users' potential home(s).</span>
<span class="co">#&gt; ⌛ Extracting time: 0.724 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_home</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">3</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   u_id     data              home </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;            &lt;chr&gt;</span>
<span class="co">#&gt; 1 67314149 &lt;tibble [3 × 11]&gt; 323  </span>
<span class="co">#&gt; 2 70005330 &lt;tibble [6 × 11]&gt; 946  </span>
<span class="co">#&gt; 3 74570766 &lt;tibble [6 × 11]&gt; 393</span>
<span class="no">df_home</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">3</span>]]
<span class="co">#&gt; # A tibble: 6 x 11</span>
<span class="co">#&gt;   grid_id s_n_tweets_loc s_n_hrs_loc s_n_days_loc s_period_loc s_n_wdays_loc</span>
<span class="co">#&gt;     &lt;int&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1     393        0.1          0.1          0.1          0.0843        0.1   </span>
<span class="co">#&gt; 2     359        0.00942      0.0958       0.0374       0.0411        0.1   </span>
<span class="co">#&gt; 3     394        0.00689      0.0875       0.0245       0.0550        0.1   </span>
<span class="co">#&gt; 4     364        0.00169      0.0458       0.0117       0.0864        0.0857</span>
<span class="co">#&gt; 5     358        0.00492      0.0917       0.0319       0.1           0.1   </span>
<span class="co">#&gt; 6     360        0.00162      0.0583       0.0129       0.0909        0.1   </span>
<span class="co">#&gt; # … with 5 more variables: s_n_months_loc &lt;dbl&gt;, s_weekend &lt;dbl&gt;, s_rest &lt;dbl&gt;,</span>
<span class="co">#&gt; #   s_wk_am &lt;dbl&gt;, score &lt;dbl&gt;</span></pre></body></html></div>
</div>
<div id="spread" class="section level3">
<h3 class="hasAnchor">
<a href="#spread" class="anchor"></a>Spread</h3>
<p>The <code><a href="../reference/spread_nested.html">spread_nested()</a></code> function in <code>spread.R</code> script works in the same way as <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/spread">spread</a> function in <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> but for nested dataframe. It allows to spread a Key-Value Pair across multiple columns.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>var_key</code>: column name or position</li>
<li>
<code>var_value</code>: column name or position</li>
</ul>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># let's add one timeframe variable first and calculate the number of data points at each timeframe</span>
<span class="no">df_timeframe</span> <span class="kw">&lt;-</span> <span class="no">df_enriched</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/mutate_nested.html">mutate_nested</a></span>(<span class="kw">timeframe</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="no">hour</span> <span class="kw">&gt;=</span> <span class="fl">2</span> <span class="kw">&amp;</span> <span class="no">hour</span> <span class="kw">&lt;</span> <span class="fl">8</span>, <span class="st">"Rest"</span>, <span class="fu">if_else</span>(<span class="no">hour</span> <span class="kw">&gt;=</span> <span class="fl">8</span> <span class="kw">&amp;</span> <span class="no">hour</span> <span class="kw">&lt;</span> <span class="fl">19</span>, <span class="st">"Active"</span>, <span class="st">"Leisure"</span>)))
<span class="co">#&gt; 🛠 Start adding variable(s)...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish adding! There are 1 new added variables: timeframe</span>
<span class="co">#&gt; ⌛ Adding time: 1.04 secs</span>
<span class="co">#&gt; </span>

<span class="no">colnames_nested_data</span> <span class="kw">&lt;-</span> <span class="no">df_timeframe</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>()
<span class="no">colnmaes_to_nest</span> <span class="kw">&lt;-</span> <span class="no">colnames_nested_data</span>[-<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">colnames_nested_data</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"grid_id"</span>, <span class="st">"timeframe"</span>))]

<span class="no">df_timeframe</span> <span class="kw">&lt;-</span> <span class="no">df_timeframe</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">20</span>) <span class="kw">%&gt;%</span> <span class="co"># take first 20 users as example</span>
  <span class="fu"><a href="../reference/summarise_double_nested.html">summarise_double_nested</a></span>(<span class="no">.</span>, <span class="kw">nest_cols</span> <span class="kw">=</span> <span class="no">colnmaes_to_nest</span>,
                            <span class="kw">n_points_timeframe</span> <span class="kw">=</span> <span class="fu">n</span>())
<span class="co">#&gt; 🛠 Start summarising values...</span>
<span class="co">#&gt; ✅ Finish summarising! There are 1 new added variables: n_points_timeframe</span>
<span class="co">#&gt; ⌛ Summarising time: 0.405 secs</span>
<span class="co">#&gt; </span>
<span class="no">df_timeframe</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">2</span>]]
<span class="co">#&gt; # A tibble: 37 x 4</span>
<span class="co">#&gt;    grid_id timeframe data              n_points_timeframe</span>
<span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;     &lt;list&gt;                         &lt;int&gt;</span>
<span class="co">#&gt;  1    1012 Active    &lt;tibble [1 × 7]&gt;                   1</span>
<span class="co">#&gt;  2     703 Rest      &lt;tibble [4 × 7]&gt;                   4</span>
<span class="co">#&gt;  3     765 Rest      &lt;tibble [7 × 7]&gt;                   7</span>
<span class="co">#&gt;  4     824 Active    &lt;tibble [3 × 7]&gt;                   3</span>
<span class="co">#&gt;  5     765 Active    &lt;tibble [11 × 7]&gt;                 11</span>
<span class="co">#&gt;  6     763 Rest      &lt;tibble [2 × 7]&gt;                   2</span>
<span class="co">#&gt;  7     704 Active    &lt;tibble [1 × 7]&gt;                   1</span>
<span class="co">#&gt;  8    1011 Active    &lt;tibble [3 × 7]&gt;                   3</span>
<span class="co">#&gt;  9    1082 Active    &lt;tibble [2 × 7]&gt;                   2</span>
<span class="co">#&gt; 10     828 Active    &lt;tibble [2 × 7]&gt;                   2</span>
<span class="co">#&gt; # … with 27 more rows</span>

<span class="co"># spread timeframe in nested dataframe with key is timeframe and value is n_points_timeframe</span>
<span class="no">df_timeframe_spreaded</span> <span class="kw">&lt;-</span> <span class="no">df_timeframe</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/spread_nested.html">spread_nested</a></span>(<span class="no">.</span>, <span class="kw">key_var</span> <span class="kw">=</span> <span class="st">"timeframe"</span>, <span class="kw">value_var</span> <span class="kw">=</span> <span class="st">"n_points_timeframe"</span>)
<span class="co">#&gt; 🛠 Start spreading timeframe variable...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish spreading! There are 3 new added variables: Active, Leisure, Rest</span>
<span class="co">#&gt; ⌛ Spreading time: 0.621 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_timeframe_spreaded</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">2</span>]]
<span class="co">#&gt; # A tibble: 37 x 5</span>
<span class="co">#&gt;    grid_id data             Active Leisure  Rest</span>
<span class="co">#&gt;      &lt;int&gt; &lt;list&gt;            &lt;int&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     438 &lt;tibble [1 × 7]&gt;      0       0     1</span>
<span class="co">#&gt;  2     481 &lt;tibble [1 × 7]&gt;      1       0     0</span>
<span class="co">#&gt;  3     537 &lt;tibble [1 × 7]&gt;      0       0     1</span>
<span class="co">#&gt;  4     537 &lt;tibble [5 × 7]&gt;      5       0     0</span>
<span class="co">#&gt;  5     578 &lt;tibble [1 × 7]&gt;      1       0     0</span>
<span class="co">#&gt;  6     648 &lt;tibble [1 × 7]&gt;      0       0     1</span>
<span class="co">#&gt;  7     691 &lt;tibble [1 × 7]&gt;      1       0     0</span>
<span class="co">#&gt;  8     691 &lt;tibble [1 × 7]&gt;      0       0     1</span>
<span class="co">#&gt;  9     703 &lt;tibble [4 × 7]&gt;      0       0     4</span>
<span class="co">#&gt; 10     703 &lt;tibble [4 × 7]&gt;      4       0     0</span>
<span class="co">#&gt; # … with 27 more rows</span></pre></body></html></div>
</div>
<div id="arrange" class="section level3">
<h3 class="hasAnchor">
<a href="#arrange" class="anchor"></a>Arrange</h3>
<p>The <code><a href="../reference/arrange_nested.html">arrange_nested()</a></code> function in <code>spread.R</code> script works in the same way as <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/arrange">arrange</a> function in <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> but for nested dataframe. It allows to sort rows by variables.</p>
<ul>
<li>
<code>df</code>: a nested dataframe</li>
<li>
<code>...</code>: comma separated list of unquoted variable names</li>
</ul>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">df_enriched</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">3</span>]]
<span class="co">#&gt; # A tibble: 5,889 x 8</span>
<span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span>
<span class="co">#&gt;    &lt;dttm&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1 2013-04-30 18:47:58    1188  2013     4    30     3    18 2013-04-30</span>
<span class="co">#&gt;  2 2014-02-27 06:09:02    1441  2014     2    27     5     6 2014-02-27</span>
<span class="co">#&gt;  3 2015-07-25 09:07:42     363  2015     7    25     7     9 2015-07-25</span>
<span class="co">#&gt;  4 2013-04-30 14:46:12    1127  2013     4    30     3    14 2013-04-30</span>
<span class="co">#&gt;  5 2013-04-05 11:16:16    1127  2013     4     5     6    11 2013-04-05</span>
<span class="co">#&gt;  6 2013-01-13 17:04:50    1127  2013     1    13     1    17 2013-01-13</span>
<span class="co">#&gt;  7 2013-05-21 23:12:55    1251  2013     5    21     3    23 2013-05-21</span>
<span class="co">#&gt;  8 2013-03-10 05:25:44    1194  2013     3    10     1     5 2013-03-10</span>
<span class="co">#&gt;  9 2013-01-05 04:53:30    1492  2013     1     5     7     4 2013-01-05</span>
<span class="co">#&gt; 10 2014-02-12 16:25:32    1127  2014     2    12     4    16 2014-02-12</span>
<span class="co">#&gt; # … with 5,879 more rows</span>

<span class="no">df_arranged</span> <span class="kw">&lt;-</span> <span class="no">df_enriched</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/arrange_nested.html">arrange_nested</a></span>(<span class="fu">desc</span>(<span class="no">hour</span>)) <span class="co"># arrange the hour in descending order</span>
<span class="co">#&gt; 🛠 Start sorting...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish sorting!</span>
<span class="co">#&gt; ⌛ Sorting time: 0.632 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_arranged</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">3</span>]]
<span class="co">#&gt; # A tibble: 5,889 x 8</span>
<span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span>
<span class="co">#&gt;    &lt;dttm&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1 2013-05-21 23:12:55    1251  2013     5    21     3    23 2013-05-21</span>
<span class="co">#&gt;  2 2013-05-23 23:25:54    1127  2013     5    23     5    23 2013-05-23</span>
<span class="co">#&gt;  3 2014-02-19 23:02:57    1127  2014     2    19     4    23 2014-02-19</span>
<span class="co">#&gt;  4 2013-05-06 23:44:23    1190  2013     5     6     2    23 2013-05-06</span>
<span class="co">#&gt;  5 2013-01-18 23:21:27     767  2013     1    18     6    23 2013-01-18</span>
<span class="co">#&gt;  6 2013-01-03 23:49:33    1127  2013     1     3     5    23 2013-01-03</span>
<span class="co">#&gt;  7 2014-03-07 23:05:01    1667  2014     3     7     6    23 2014-03-07</span>
<span class="co">#&gt;  8 2014-07-17 23:20:04    1127  2014     7    17     5    23 2014-07-17</span>
<span class="co">#&gt;  9 2013-02-03 23:17:35    1127  2013     2     3     1    23 2013-02-03</span>
<span class="co">#&gt; 10 2013-05-06 23:01:25    1190  2013     5     6     2    23 2013-05-06</span>
<span class="co">#&gt; # … with 5,879 more rows</span></pre></body></html></div>
<p>The <code><a href="../reference/arrange_double_nested.html">arrange_double_nested()</a></code> funtion works in the similar way as <code><a href="../reference/arrange_nested.html">arrange_nested()</a></code> function, but it applys to double nested dataframe. You need to choose the columns to nest inside a nested dataframe and then sort rows by selected column.</p>
<pre><code>- `df`: a nested dataframe 
- `nest_cols`: name of columns to nest in existing list-column
- `...`: comma separated list of unquoted variable names </code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># get the name of columns to nest </span>
<span class="no">colnames_nested_data</span> <span class="kw">&lt;-</span> <span class="no">df_enriched</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>()
<span class="no">colnmaes_to_nest</span> <span class="kw">&lt;-</span> <span class="no">colnames_nested_data</span>[-<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">colnames_nested_data</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"grid_id"</span>))]

<span class="no">df_double_arranged</span> <span class="kw">&lt;-</span> <span class="no">df_enriched</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">20</span>) <span class="kw">%&gt;%</span> <span class="co"># take the first 20 users for example</span>
  <span class="fu"><a href="../reference/arrange_double_nested.html">arrange_double_nested</a></span>(<span class="no">.</span>, <span class="kw">nest_cols</span> <span class="kw">=</span> <span class="no">colnmaes_to_nest</span>,
                        <span class="fu">desc</span>(<span class="no">created_at</span>)) <span class="co"># sort by time in descending order</span>
<span class="co">#&gt; 🛠 Start sorting...</span>
<span class="co">#&gt; ✅ Finish sorting!</span>
<span class="co">#&gt; ⌛ Sorting time: 0.197 secs</span>
<span class="co">#&gt; </span>


<span class="co"># original third user</span>
<span class="no">df_enriched</span>[<span class="fl">3</span>, ]
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   u_id     data                </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;              </span>
<span class="co">#&gt; 1 16294855 &lt;tibble [5,889 × 8]&gt;</span>
<span class="co"># third user data points </span>
<span class="no">df_enriched</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">3</span>]]
<span class="co">#&gt; # A tibble: 5,889 x 8</span>
<span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span>
<span class="co">#&gt;    &lt;dttm&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1 2013-04-30 18:47:58    1188  2013     4    30     3    18 2013-04-30</span>
<span class="co">#&gt;  2 2014-02-27 06:09:02    1441  2014     2    27     5     6 2014-02-27</span>
<span class="co">#&gt;  3 2015-07-25 09:07:42     363  2015     7    25     7     9 2015-07-25</span>
<span class="co">#&gt;  4 2013-04-30 14:46:12    1127  2013     4    30     3    14 2013-04-30</span>
<span class="co">#&gt;  5 2013-04-05 11:16:16    1127  2013     4     5     6    11 2013-04-05</span>
<span class="co">#&gt;  6 2013-01-13 17:04:50    1127  2013     1    13     1    17 2013-01-13</span>
<span class="co">#&gt;  7 2013-05-21 23:12:55    1251  2013     5    21     3    23 2013-05-21</span>
<span class="co">#&gt;  8 2013-03-10 05:25:44    1194  2013     3    10     1     5 2013-03-10</span>
<span class="co">#&gt;  9 2013-01-05 04:53:30    1492  2013     1     5     7     4 2013-01-05</span>
<span class="co">#&gt; 10 2014-02-12 16:25:32    1127  2014     2    12     4    16 2014-02-12</span>
<span class="co">#&gt; # … with 5,879 more rows</span>
<span class="co"># arranged third user</span>
<span class="no">df_double_arranged</span>[<span class="fl">3</span>, ]
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   u_id     data              </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;            </span>
<span class="co">#&gt; 1 16294855 &lt;tibble [372 × 2]&gt;</span>
<span class="co"># arranged time </span>
<span class="no">df_double_arranged</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">3</span>]]$<span class="no">data</span><span class="kw">[[</span><span class="fl">2</span>]]
<span class="co">#&gt; # A tibble: 63 x 7</span>
<span class="co">#&gt;    created_at           year month   day  wday  hour ymd       </span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1 2015-10-11 11:36:58  2015    10    11     1    11 2015-10-11</span>
<span class="co">#&gt;  2 2015-10-02 13:15:53  2015    10     2     6    13 2015-10-02</span>
<span class="co">#&gt;  3 2015-09-15 06:09:22  2015     9    15     3     6 2015-09-15</span>
<span class="co">#&gt;  4 2015-08-28 04:03:26  2015     8    28     6     4 2015-08-28</span>
<span class="co">#&gt;  5 2015-08-21 13:54:24  2015     8    21     6    13 2015-08-21</span>
<span class="co">#&gt;  6 2015-08-21 10:47:19  2015     8    21     6    10 2015-08-21</span>
<span class="co">#&gt;  7 2015-08-19 00:38:24  2015     8    19     4     0 2015-08-19</span>
<span class="co">#&gt;  8 2015-08-08 19:36:28  2015     8     8     7    19 2015-08-08</span>
<span class="co">#&gt;  9 2015-07-31 15:19:08  2015     7    31     6    15 2015-07-31</span>
<span class="co">#&gt; 10 2015-07-30 15:47:16  2015     7    30     5    15 2015-07-30</span>
<span class="co">#&gt; # … with 53 more rows</span></pre></body></html></div>
</div>
<div id="top-n" class="section level3">
<h3 class="hasAnchor">
<a href="#top-n" class="anchor"></a>Top N</h3>
<p>The <code><a href="../reference/top_n_nested.html">top_n_nested()</a></code> function in the <code>top_n.R</code> script works in the same way as <a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a> function in <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> but for nested dataframe. It allows to select the top entries in each group, ordered by wt.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">df_enriched</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">2</span>]]
<span class="co">#&gt; # A tibble: 79 x 8</span>
<span class="co">#&gt;    created_at          grid_id  year month   day  wday  hour ymd       </span>
<span class="co">#&gt;    &lt;dttm&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1 2013-06-11 14:12:45    1012  2013     6    11     3    14 2013-06-11</span>
<span class="co">#&gt;  2 2012-08-12 02:02:30     703  2012     8    12     1     2 2012-08-12</span>
<span class="co">#&gt;  3 2012-07-29 04:49:01     765  2012     7    29     1     4 2012-07-29</span>
<span class="co">#&gt;  4 2012-11-02 11:53:18     824  2012    11     2     6    11 2012-11-02</span>
<span class="co">#&gt;  5 2013-03-14 09:02:26     765  2013     3    14     5     9 2013-03-14</span>
<span class="co">#&gt;  6 2013-03-19 11:24:04     765  2013     3    19     3    11 2013-03-19</span>
<span class="co">#&gt;  7 2013-06-10 04:51:46     763  2013     6    10     2     4 2013-06-10</span>
<span class="co">#&gt;  8 2013-03-03 14:23:44     704  2013     3     3     1    14 2013-03-03</span>
<span class="co">#&gt;  9 2013-02-23 10:36:17    1011  2013     2    23     7    10 2013-02-23</span>
<span class="co">#&gt; 10 2013-06-02 16:15:58    1082  2013     6     2     1    16 2013-06-02</span>
<span class="co">#&gt; # … with 69 more rows</span>

<span class="co">## get the top 1 row based on hour </span>
<span class="no">df_top_1</span> <span class="kw">&lt;-</span> <span class="no">df_enriched</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/top_n_nested.html">top_n_nested</a></span>(<span class="no">.</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">wt</span> <span class="kw">=</span> <span class="st">"hour"</span>)
<span class="co">#&gt; 🛠 Start selecting top 1 row(s)...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✅ Finish selecting top 1 row(s)!</span>
<span class="co">#&gt; ⌛ Selecting time: 1.148 secs</span>
<span class="co">#&gt; </span>

<span class="no">df_top_1</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">2</span>]]
<span class="co">#&gt; # A tibble: 1 x 8</span>
<span class="co">#&gt;   created_at          grid_id  year month   day  wday  hour ymd       </span>
<span class="co">#&gt;   &lt;dttm&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt; 1 2012-08-16 23:21:54     766  2012     8    16     5    23 2012-08-16</span></pre></body></html></div>
</div>
<div id="identify-locations-with-embedded-recipes" class="section level3">
<h3 class="hasAnchor">
<a href="#identify-locations-with-embedded-recipes" class="anchor"></a>Identify location(s) with embedded recipes</h3>
<p>To use the embedded recipes identifying the home location for users, you can use <code><a href="../reference/identify_location.html">identify_location()</a></code> function in <code>identify_location.R</code> script.</p>
<ul>
<li>
<code>df</code>: a dataframe with columns for the user id, location, timestamp</li>
<li>
<code>user</code>: name of column that holds unique identifier for each user</li>
<li>
<code>timestamp</code>: name of timestamp column. Should be POSIXct</li>
<li>
<code>location</code>: name of column that holds unique identifier for each location</li>
<li>
<code>tz</code>: a character string containing the time zone to convert to and it should be recognized in R</li>
<li>
<code>recipe</code>: embeded algorithms to identify the most possible home locations for users<br>
</li>
<li>
<code>show_n_loc</code>: number of potential homes to extract</li>
<li>
<code>keep_score</code>: option to keep or remove calculated result/score per user per location</li>
</ul>
<p>Current available recipes:</p>
<ul>
<li>
<code>recipe_HMLC</code>:
<ul>
<li>Weighs data points across multiple time frames to ‘score’ potentially meaningful locations for each user</li>
</ul>
</li>
<li>
<code>recipe_FREQ</code>
<ul>
<li>Selects the most frequently ‘visited’ location assuming a user is active mainly around their home location.</li>
</ul>
</li>
<li>
<code>recipe_OSNA</code>: <a href="https://www.researchgate.net/publication/279884727_Identification_of_Key_Locations_based_on_Online_Social_Network_Activity">Efstathiades et al.2015</a>
<ul>
<li>Finds the most ‘popular’ location during ‘rest’, ‘active’ and ‘leisure time. Here we focus on ’rest’ and ‘leisure’ time to find the most possible home location for each user.</li>
</ul>
</li>
<li>
<code>recipe_APDM</code>: <a href="https://www.researchgate.net/publication/233197970_Using_Mobile_Positioning_Data_to_Model_Locations_Meaningful_to_Users_of_Mobile_Phones">Ahas et al. 2010</a>
<ul>
<li>Calculates the average and standard deviation of start time data points by a single user, in a single location.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="co"># recipe: homelocator -- HMLC</span>
<span class="fu"><a href="../reference/identify_location.html">identify_location</a></span>(<span class="no">test_sample</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">timestamp</span> <span class="kw">=</span> <span class="st">"created_at"</span>,
                  <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">show_n_loc</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">recipe</span> <span class="kw">=</span> <span class="st">"HMLC"</span>)

<span class="co"># recipe: Frequency -- FREQ</span>
<span class="fu"><a href="../reference/identify_location.html">identify_location</a></span>(<span class="no">test_sample</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">timestamp</span> <span class="kw">=</span> <span class="st">"created_at"</span>,
                  <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">show_n_loc</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">recipe</span> <span class="kw">=</span> <span class="st">"FREQ"</span>)

<span class="co"># recipe: Online Social Network Activity -- OSNA</span>
<span class="fu"><a href="../reference/identify_location.html">identify_location</a></span>(<span class="no">test_sample</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">timestamp</span> <span class="kw">=</span> <span class="st">"created_at"</span>,
                  <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">show_n_loc</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">recipe</span> <span class="kw">=</span> <span class="st">"OSNA"</span>)

<span class="co"># recipe: Online Social Network Activity -- APDM</span>
<span class="co">## APDM recipe strictly returns the most likely home location</span>
<span class="co">## It is important to load the neighbors table before you use the recipe!!</span>
<span class="co">## example: st_queen &lt;- function(a, b = a) st_relate(a, b, pattern = "F***T****")</span>
<span class="co">##          neighbors &lt;- st_queen(df_sf) ===&gt; convert result to dataframe </span>
<span class="no">df_neighbors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"data/neighbors.rds"</span>))
<span class="fu"><a href="../reference/identify_location.html">identify_location</a></span>(<span class="no">test_sample</span>, <span class="kw">user</span> <span class="kw">=</span> <span class="st">"u_id"</span>, <span class="kw">timestamp</span> <span class="kw">=</span> <span class="st">"created_at"</span>,
                  <span class="kw">location</span> <span class="kw">=</span> <span class="st">"grid_id"</span>, <span class="kw">recipe</span> <span class="kw">=</span> <span class="st">"APDM"</span>, <span class="kw">keep_score</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Qingqing Chen, Ate Poorthuis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
